
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>2. CRUD : Création &#8212; Neo4j</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../_static/tabs.js?v=3ee01567"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/02_creation';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3. CRUD : Lecture" href="03_lecture.html" />
    <link rel="prev" title="1. Langage Cypher" href="01_cypher.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="00_intro.html">
  
  
  
  
  
  
    <p class="title logo__title">Neo4j</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="00_intro.html">
                    Neo4j : Base de données NoSQL orientée graphe
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Chapitres</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01_cypher.html">1. Langage Cypher</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">2. <strong>C</strong>RUD : Création</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="03_lecture.html">3. C<strong>R</strong>UD : Lecture</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="03_lecture_simple.html">3.1. Requête simple</a></li>
<li class="toctree-l2"><a class="reference internal" href="03_lecture_complexe.html">3.2. Requête complexe</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="04_modification.html">4. CR<strong>U</strong>D : Modification</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_suppression.html">5. CRU<strong>D</strong> : Suppression</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/elenaberhoco/neo4j" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/elenaberhoco/neo4j/issues/new?title=Issue%20on%20page%20%2Fcontent/02_creation.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/content/02_creation.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>CRUD : Création</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creer-un-noeud">2.1. Créer un noeud</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create">2.1.1. <code class="docutils literal notranslate"><span class="pre">CREATE</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#match-et-create">2.1.2. <code class="docutils literal notranslate"><span class="pre">MATCH</span></code> et <code class="docutils literal notranslate"><span class="pre">CREATE</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#merge">2.1.3. <code class="docutils literal notranslate"><span class="pre">MERGE</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creer-une-relation">2.2. Créer une relation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">2.2.1. <code class="docutils literal notranslate"><span class="pre">CREATE</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">2.2.2. <code class="docutils literal notranslate"><span class="pre">MATCH</span></code> et <code class="docutils literal notranslate"><span class="pre">CREATE</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#match-et-merge">2.2.3. <code class="docutils literal notranslate"><span class="pre">MATCH</span></code> et <code class="docutils literal notranslate"><span class="pre">MERGE</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creer-des-noeuds-et-des-relations">2.3. Créer des noeuds et des relations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creer-un-index">2.4. Créer un index</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creer-une-contrainte">2.5. Créer une contrainte</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="crud-creation">
<h1><span class="section-number">2. </span><strong>C</strong>RUD : Création<a class="headerlink" href="#crud-creation" title="Link to this heading">#</a></h1>
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row sd-g-1 sd-g-xs-1 sd-g-sm-1 sd-g-md-1 sd-g-lg-1 docutils">
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
Objectif</div>
<p class="sd-card-text">Dans ce chapitre vous apprendrez à insérer des noeuds et des relations dans une base de données Neo4j.</p>
</div>
</div>
</div>
</div>
</div>
<p>Nous allons construire ce graphe :</p>
<figure class="align-default" id="id3">
<img alt="../_images/exemple_neo4j_creation.png" src="../_images/exemple_neo4j_creation.png" />
<figcaption>
<p><span class="caption-number">Fig. 2.1 </span><span class="caption-text">Exemple from: <a class="reference external" href="https://neo4j.com/docs/cypher-manual/current/subqueries/collect/">source</a></span><a class="headerlink" href="#id3" title="Link to this image">#</a></p>
</figcaption>
</figure>
<section id="creer-un-noeud">
<h2><span class="section-number">2.1. </span>Créer un noeud<a class="headerlink" href="#creer-un-noeud" title="Link to this heading">#</a></h2>
<section id="create">
<h3><span class="section-number">2.1.1. </span><code class="docutils literal notranslate"><span class="pre">CREATE</span></code><a class="headerlink" href="#create" title="Link to this heading">#</a></h3>
<p>La clause <code class="docutils literal notranslate"><span class="pre">CREATE</span></code> permet de <strong>créer un ou plusieurs noeuds</strong>. Chaque noeud peut se voir attribuer des <strong>labels</strong> et des <strong>propriétés</strong>.
La syntaxe est la suivante :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">node</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">Labels</span><span class="o">&gt;</span><span class="p">{</span><span class="o">&lt;</span><span class="n">key</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span><span class="p">,</span><span class="o">...</span><span class="p">}),</span> <span class="o">...</span>
</pre></div>
</div>
<p>où :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;node&gt;</span></code> : nom de la variable qui pointera vers les noeuds sélectionnés, si besoin (voir Chapitre 3)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;Labels&gt;</span></code> : un ou plusieurs labels</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{&lt;key&gt;:&lt;value&gt;,...}</span></code> : propriétés</p></li>
</ul>
<p>Il est possible de spécifier <strong>plusieurs labels</strong> en utilisant :</p>
<ul class="simple">
<li><p>soit <code class="docutils literal notranslate"><span class="pre">:</span></code>, syntaxe : <code class="docutils literal notranslate"><span class="pre">(&lt;node&gt;:&lt;Label1&gt;:&lt;Label2&gt;:...)</span></code></p></li>
<li><p>soit <code class="docutils literal notranslate"><span class="pre">&amp;</span></code>, syntaxe : <code class="docutils literal notranslate"><span class="pre">(&lt;node&gt;:&lt;Label1&gt;&amp;&lt;Label2&gt;:...)</span></code></p></li>
</ul>
<p>Vous pouvez créer <strong>plusieurs noeuds</strong> à la fois en les séparant par des virgules.</p>
<div class="tip admonition">
<p class="admonition-title">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="p">(:</span><span class="n">Person</span><span class="p">:</span><span class="n">Director</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="s1">&#39;Tim Burton&#39;</span><span class="p">}),</span> 
       <span class="p">(:</span><span class="n">Person</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="s1">&#39;Benedict Cumberbatch&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p><strong>Si le noeud existe déjà, il sera dupliqué</strong> (sauf si contrainte d’unicité) ! Pour éviter cela, préférez <code class="docutils literal notranslate"><span class="pre">MERGE</span></code> et posez des contraintes d’unicité.
<code class="docutils literal notranslate"><span class="pre">CREATE</span></code> est plus adapté à la construction initiale de la base de données,
tandis que <code class="docutils literal notranslate"><span class="pre">MERGE</span></code> convient mieux lorsque vous souhaitez ajouter des noeuds à une base de données déjà existante.</p>
</div>
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row sd-g-1 sd-g-xs-1 sd-g-sm-1 sd-g-md-1 sd-g-lg-1 docutils">
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
Exercice</div>
<ol class="arabic simple">
<li><p class="sd-card-text">Créez un noeud <code class="docutils literal notranslate"><span class="pre">Person</span></code> avec pour nom (<code class="docutils literal notranslate"><span class="pre">name</span></code>) <code class="docutils literal notranslate"><span class="pre">Andy</span></code> et pour <code class="docutils literal notranslate"><span class="pre">age</span></code> <code class="docutils literal notranslate"><span class="pre">36</span></code></p></li>
<li><p class="sd-card-text">Créez un noeud de labels <code class="docutils literal notranslate"><span class="pre">Dog</span></code> et <code class="docutils literal notranslate"><span class="pre">Pet</span></code> avec pour nom (<code class="docutils literal notranslate"><span class="pre">name</span></code>) <code class="docutils literal notranslate"><span class="pre">Ozzy</span></code> et pour jouet (<code class="docutils literal notranslate"><span class="pre">toy</span></code>) <code class="docutils literal notranslate"><span class="pre">Banana</span></code></p></li>
</ol>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="match-et-create">
<h3><span class="section-number">2.1.2. </span><code class="docutils literal notranslate"><span class="pre">MATCH</span></code> et <code class="docutils literal notranslate"><span class="pre">CREATE</span></code><a class="headerlink" href="#match-et-create" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">MATCH</span></code>, combiné ou non à d’autres clauses, permet d’utiliser les propriétés de noeuds existants lors de la création d’un nouveau noeud.</p>
<div class="tip admonition">
<p class="admonition-title">Example</p>
<p>Imaginons que vous vouliez avoir facilement accès à l’ensemble des films sortis en 1992, sans avoir besoin de parcourir toutes les propriétés de tous les noeuds
<code class="docutils literal notranslate"><span class="pre">Movie</span></code> à chaque fois :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MATCH</span> <span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="n">Movie</span><span class="p">{</span><span class="n">released</span><span class="p">:</span><span class="mi">1992</span><span class="p">})</span>
<span class="n">WITH</span> <span class="n">collect</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">title</span><span class="p">)</span> <span class="k">as</span> <span class="n">movies</span>
<span class="n">CREATE</span> <span class="p">(:</span><span class="n">Year</span><span class="p">{</span><span class="n">released</span><span class="p">:</span><span class="mi">1992</span><span class="p">,</span> <span class="n">movies</span><span class="p">:</span><span class="n">movies</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row sd-g-1 sd-g-xs-1 sd-g-sm-1 sd-g-md-1 sd-g-lg-1 docutils">
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
Exercice</div>
<ol class="arabic simple">
<li><p class="sd-card-text">Créez des noeuds <code class="docutils literal notranslate"><span class="pre">Toy</span></code> avec le nom (<code class="docutils literal notranslate"><span class="pre">name</span></code>) des jouets (<code class="docutils literal notranslate"><span class="pre">toy</span></code>) des chiens et des chats. Pensez bien à exclure les noeuds qui n’ont pas de propriété <code class="docutils literal notranslate"><span class="pre">toy</span></code> !</p></li>
</ol>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="merge">
<h3><span class="section-number">2.1.3. </span><code class="docutils literal notranslate"><span class="pre">MERGE</span></code><a class="headerlink" href="#merge" title="Link to this heading">#</a></h3>
<p>La clause <code class="docutils literal notranslate"><span class="pre">MERGE</span></code> agit comme une combinaison de <code class="docutils literal notranslate"><span class="pre">MATCH</span></code> et <code class="docutils literal notranslate"><span class="pre">CREATE</span></code> : elle vérifie d’abord l’existence d’un noeud, avant de le créer s’il n’existe pas.
Vous ne pouvez spécifier qu’un seul noeud à la fois avec <code class="docutils literal notranslate"><span class="pre">MERGE</span></code>.</p>
<div class="tip admonition">
<p class="admonition-title">Example</p>
<p>Notez la différence du message renvoyé par Neo4j après exécution de ces deux instructions :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MERGE</span> <span class="p">(:</span><span class="n">Person</span><span class="p">:</span><span class="n">Director</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="s1">&#39;Tim Burton&#39;</span><span class="p">})</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MERGE</span> <span class="p">(:</span><span class="n">Movie</span> <span class="p">{</span><span class="n">title</span><span class="p">:</span><span class="s1">&#39;The Hobbit&#39;</span><span class="p">,</span> <span class="n">released</span><span class="p">:</span><span class="mi">2012</span><span class="p">,</span> <span class="n">tagline</span><span class="p">:</span><span class="s2">&quot;From the smallest beginnings come the greatest legends&quot;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Si la <strong>correspondance n’est pas exacte</strong> entre un <strong>noeud existant</strong> et le <strong>noeud à créer</strong>, et si le noeud à créer a des <strong>propriétés</strong> ou des <strong>labels</strong>
que le noeud existant n’a pas, alors un <strong>nouveau noeud</strong> sera <strong>créé</strong> (sauf si contrainte d’unicité).</p>
<p>Par exemple, écrire :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MERGE</span> <span class="p">(:</span><span class="n">Person</span><span class="p">:</span><span class="n">Actor</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="s1">&#39;Benedict Cumberbatch&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>créerait un nouveau noeud, car le seul noeud existant contenant cette propriété est le noeud <code class="docutils literal notranslate"><span class="pre">(:Person</span> <span class="pre">{name:'Benedict</span> <span class="pre">Cumberbatch'})</span></code> qui ne possède que
le label <code class="docutils literal notranslate"><span class="pre">Person</span></code>.</p>
<p>En revanche, si vous ne spécifiez qu’un <strong>sous-ensemble</strong> des propriétés et/ou des labels, le noeud sera reconnu.</p>
<p>Par exemple, écrire :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MERGE</span> <span class="p">(:</span><span class="n">Person</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="s1">&#39;Tim Burton&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>sélectionnerait le noeud <code class="docutils literal notranslate"><span class="pre">(:Person:Director</span> <span class="pre">{name:'Tim</span> <span class="pre">Burton'})</span></code>.</p>
</div>
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row sd-g-1 sd-g-xs-1 sd-g-sm-1 sd-g-md-1 sd-g-lg-1 docutils">
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
Exercice</div>
<ol class="arabic simple">
<li><p class="sd-card-text">Créez un noeud de labels <code class="docutils literal notranslate"><span class="pre">Dog</span></code> et <code class="docutils literal notranslate"><span class="pre">Pet</span></code> avec pour nom (<code class="docutils literal notranslate"><span class="pre">name</span></code>) <code class="docutils literal notranslate"><span class="pre">Popo</span></code></p></li>
</ol>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="creer-une-relation">
<h2><span class="section-number">2.2. </span>Créer une relation<a class="headerlink" href="#creer-une-relation" title="Link to this heading">#</a></h2>
<section id="id1">
<h3><span class="section-number">2.2.1. </span><code class="docutils literal notranslate"><span class="pre">CREATE</span></code><a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>La clause <code class="docutils literal notranslate"><span class="pre">CREATE</span></code> permet de <strong>créer une ou plusieurs relations ainsi que les noeuds associés</strong>.
Chaque relation doit avoir <strong>exactement un type</strong> et une <strong>direction</strong>. Elle peut aussi se voir attribuer des <strong>propriétés</strong>.
La syntaxe est la suivante (l’orientation de la flèche est purement illustrative) :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">start_node</span><span class="o">&gt;</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="o">&lt;</span><span class="n">relationship</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">TYPE</span><span class="o">&gt;</span><span class="p">{</span><span class="o">&lt;</span><span class="n">key</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span><span class="p">,</span><span class="o">...</span><span class="p">}]</span><span class="o">-&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="n">end_node</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">...</span>
</pre></div>
</div>
<p>où :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;start_node&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;end_node&gt;</span></code> : noeuds tels que définis à la section précédente</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;relationship&gt;</span></code> : nom de la variable qui pointera vers les relations sélectionnées, si besoin (voir Chapitre 3)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;TYPE&gt;</span></code> : type de la relation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{&lt;key&gt;:&lt;value&gt;,...}</span></code> : propriétés</p></li>
</ul>
<p>La <strong>direction</strong> d’une relation doit être spécifiée à l’aide d’une flèche : <code class="docutils literal notranslate"><span class="pre">--&gt;</span></code> ou <code class="docutils literal notranslate"><span class="pre">&lt;--</span></code>.
Vous pouvez créer <strong>plusieurs relations</strong> à la fois en les séparant par des virgules.
Vous pouvez créer des <strong>motifs complexes</strong>, c’est-à-dire incluant plusieurs relations (donc aussi plusieurs noeuds).</p>
<div class="tip admonition">
<p class="admonition-title">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="p">(:</span><span class="n">Person</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="s1">&#39;Anthony Hopkins&#39;</span><span class="p">,</span> <span class="n">born</span><span class="p">:</span><span class="mi">1937</span><span class="p">})</span><span class="o">-</span><span class="p">[:</span><span class="n">ACTED_IN</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(:</span><span class="n">Movie</span> <span class="p">{</span><span class="n">title</span><span class="p">:</span><span class="s2">&quot;The Silence of the Lambs&quot;</span><span class="p">,</span> <span class="n">released</span><span class="p">:</span><span class="mi">1991</span><span class="p">})</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">DIRECTED</span><span class="p">]</span><span class="o">-</span><span class="p">(:</span><span class="n">Person</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="s1">&#39;Jonathan Demme&#39;</span><span class="p">,</span> <span class="n">born</span><span class="p">:</span><span class="mi">1944</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p><strong>Si la relation ou les noeuds existent déjà, ils seront dupliqués</strong> (sauf si contrainte d’unicité) ! Pour éviter la duplication des noeuds,
utilisez <code class="docutils literal notranslate"><span class="pre">CREATE</span></code> en combinaison avec <code class="docutils literal notranslate"><span class="pre">MATCH</span></code>.
Pour éviter toute duplication, préférez <code class="docutils literal notranslate"><span class="pre">MERGE</span></code> et posez des contraintes d’unicité.</p>
</div>
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row sd-g-1 sd-g-xs-1 sd-g-sm-1 sd-g-md-1 sd-g-lg-1 docutils">
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
Exercice</div>
<ol class="arabic simple">
<li><p class="sd-card-text">Créez une personne (<code class="docutils literal notranslate"><span class="pre">Person</span></code>) avec pour nom (<code class="docutils literal notranslate"><span class="pre">name</span></code>) <code class="docutils literal notranslate"><span class="pre">Timothy</span></code> et pour <code class="docutils literal notranslate"><span class="pre">age</span></code> <code class="docutils literal notranslate"><span class="pre">25</span></code>,
un chat (<code class="docutils literal notranslate"><span class="pre">Cat</span></code>, <code class="docutils literal notranslate"><span class="pre">Pet</span></code>) avec pour nom <code class="docutils literal notranslate"><span class="pre">Mittens</span></code>,
et une relation <code class="docutils literal notranslate"><span class="pre">HAS_CAT</span></code> avec une propriété <code class="docutils literal notranslate"><span class="pre">since</span></code> qui vaut <code class="docutils literal notranslate"><span class="pre">2019</span></code> entre les deux</p></li>
</ol>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="id2">
<h3><span class="section-number">2.2.2. </span><code class="docutils literal notranslate"><span class="pre">MATCH</span></code> et <code class="docutils literal notranslate"><span class="pre">CREATE</span></code><a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<p>Pour créer une nouvelle relation entre deux noeuds existants, faites précéder <code class="docutils literal notranslate"><span class="pre">CREATE</span></code> d’une clause <code class="docutils literal notranslate"><span class="pre">MATCH</span></code> (voir Chapitre 3).</p>
<div class="tip admonition">
<p class="admonition-title">Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MATCH</span> <span class="p">(</span><span class="n">benedict</span><span class="p">:</span><span class="n">Person</span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="s1">&#39;Benedict Cumberbatch&#39;</span><span class="p">})</span>  
<span class="n">MATCH</span> <span class="p">(</span><span class="n">hobbit</span><span class="p">:</span><span class="n">Movie</span><span class="p">{</span><span class="n">title</span><span class="p">:</span><span class="s1">&#39;The Hobbit&#39;</span><span class="p">})</span>
<span class="n">CREATE</span> <span class="p">(</span><span class="n">benedict</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">ACTED_IN</span><span class="p">{</span><span class="n">roles</span><span class="p">:[</span><span class="s1">&#39;Smaug&#39;</span><span class="p">,</span><span class="s1">&#39;Sauron&#39;</span><span class="p">]}]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">hobbit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p><strong>Si la relation existe déjà, elle sera dupliquée</strong> (sauf si contrainte d’unicité) ! Pour éviter toute duplication,
préférez <code class="docutils literal notranslate"><span class="pre">MERGE</span></code> et posez des contraintes d’unicité.</p>
</div>
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row sd-g-1 sd-g-xs-1 sd-g-sm-1 sd-g-md-1 sd-g-lg-1 docutils">
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
Exercice</div>
<ol class="arabic simple">
<li><p class="sd-card-text">Créez une relation <code class="docutils literal notranslate"><span class="pre">HAS_DOG</span></code> avec une propriété <code class="docutils literal notranslate"><span class="pre">since</span></code> qui vaut <code class="docutils literal notranslate"><span class="pre">2016</span></code> entre <code class="docutils literal notranslate"><span class="pre">Andy</span></code> et <code class="docutils literal notranslate"><span class="pre">Popo</span></code></p></li>
</ol>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="match-et-merge">
<h3><span class="section-number">2.2.3. </span><code class="docutils literal notranslate"><span class="pre">MATCH</span></code> et <code class="docutils literal notranslate"><span class="pre">MERGE</span></code><a class="headerlink" href="#match-et-merge" title="Link to this heading">#</a></h3>
<p>La clause <code class="docutils literal notranslate"><span class="pre">MERGE</span></code> permet de vérifier l’existence d’une relation, et de la créer si elle n’existe pas.</p>
<div class="tip admonition">
<p class="admonition-title">Example</p>
<p>L’instruction suivante ne crée aucune relation, car la relation existe déjà :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MATCH</span> <span class="p">(</span><span class="n">benedict</span><span class="p">:</span><span class="n">Person</span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="s1">&#39;Benedict Cumberbatch&#39;</span><span class="p">})</span>
<span class="n">MATCH</span> <span class="p">(</span><span class="n">hobbit</span><span class="p">:</span><span class="n">Movie</span><span class="p">{</span><span class="n">title</span><span class="p">:</span><span class="s1">&#39;The Hobbit&#39;</span><span class="p">})</span>
<span class="n">MERGE</span> <span class="p">(</span><span class="n">benedict</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">ACTED_IN</span><span class="p">{</span><span class="n">roles</span><span class="p">:[</span><span class="s1">&#39;Smaug&#39;</span><span class="p">,</span><span class="s1">&#39;Sauron&#39;</span><span class="p">]}]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">hobbit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row sd-g-1 sd-g-xs-1 sd-g-sm-1 sd-g-md-1 sd-g-lg-1 docutils">
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
Exercice</div>
<ol class="arabic simple">
<li><p class="sd-card-text">Créez une relation <code class="docutils literal notranslate"><span class="pre">IS_FRIEND</span></code> avec une propriété <code class="docutils literal notranslate"><span class="pre">since</span></code> qui vaut <code class="docutils literal notranslate"><span class="pre">2002</span></code> de <code class="docutils literal notranslate"><span class="pre">Andy</span></code> vers <code class="docutils literal notranslate"><span class="pre">Timothy</span></code>. Et inversement !</p></li>
</ol>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="creer-des-noeuds-et-des-relations">
<h2><span class="section-number">2.3. </span>Créer des noeuds et des relations<a class="headerlink" href="#creer-des-noeuds-et-des-relations" title="Link to this heading">#</a></h2>
<p>La clause <code class="docutils literal notranslate"><span class="pre">MERGE</span></code> permet de vérifier à la fois l’existence des noeuds et l’existence des relations, voire l’existence d’un motif complet, avant création.
Si le noeud, la relation, ou le motif existe déjà, il est sélectionné. Sinon, il est créé.</p>
<div class="tip admonition">
<p class="admonition-title">Example</p>
<p>L’instruction suivante sélectionne le noeud <code class="docutils literal notranslate"><span class="pre">Tim</span> <span class="pre">Burton</span></code> déjà existant, crée le noeud <code class="docutils literal notranslate"><span class="pre">Sleepy</span> <span class="pre">Hollow</span></code>, qui n’existe pas encore,
et crée la relation entre ces deux noeuds, qui n’existe pas encore :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MERGE</span> <span class="p">(</span><span class="n">tim</span><span class="p">:</span><span class="n">Person</span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="s1">&#39;Tim Burton&#39;</span><span class="p">})</span> 
<span class="n">MERGE</span> <span class="p">(</span><span class="n">movie</span><span class="p">:</span><span class="n">Movie</span><span class="p">{</span><span class="n">title</span><span class="p">:</span><span class="s1">&#39;Sleepy Hollow&#39;</span><span class="p">,</span> <span class="n">released</span><span class="p">:</span><span class="mi">1998</span><span class="p">,</span> <span class="n">tagline</span><span class="p">:</span><span class="s1">&#39;Sleep If You Can. You can lock the doors. You can bolt the windows. But can you survive the night?&#39;</span><span class="p">})</span>
<span class="n">MERGE</span> <span class="p">(</span><span class="n">tim</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">DIRECTED</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">movie</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Lorsque vous utilisez <code class="docutils literal notranslate"><span class="pre">MERGE</span></code> sur des <strong>motifs complets</strong>, soit le motif <strong>complet</strong> existe déjà et il est sélectionné, soit il est créé <strong>dans son intégralité</strong>,
<strong>même si certaines parties du motif existent</strong> déjà.</p>
<p>Par exemple, écrire :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MERGE</span> <span class="p">(:</span><span class="n">Person</span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="s1">&#39;Benedict Cumberbatch&#39;</span><span class="p">})</span><span class="o">-</span><span class="p">[:</span><span class="n">ACTED_IN</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(:</span><span class="n">Movie</span><span class="p">{</span><span class="n">title</span><span class="p">:</span><span class="s1">&#39;The Imitation Game&#39;</span><span class="p">,</span><span class="n">released</span><span class="p">:</span><span class="mi">2014</span><span class="p">})</span>
</pre></div>
</div>
<p>créerait un nouveau noeud <code class="docutils literal notranslate"><span class="pre">Benedict</span> <span class="pre">Cumberbatch</span></code> car le motif dans son intégralité n’existe pas : il n’existe pas de noeud <code class="docutils literal notranslate"><span class="pre">The</span> <span class="pre">Imitation</span> <span class="pre">Game</span></code> ni, donc,
de relation entre le noeud <code class="docutils literal notranslate"><span class="pre">Benedict</span> <span class="pre">Cumberbatch</span></code> et le noeud <code class="docutils literal notranslate"><span class="pre">The</span> <span class="pre">Imitation</span> <span class="pre">Game</span></code> de type <code class="docutils literal notranslate"><span class="pre">ACTED_IN</span></code>.</p>
</div>
<p>Il faut donc décomposer le motif en fonction des besoins.</p>
<div class="tip admonition">
<p class="admonition-title">Example</p>
<p>Imaginons que vous vouliez créer autant de noeuds que d’années de sortie, et lier les films à l’année qui correspond par une nouvelle relation de type
<code class="docutils literal notranslate"><span class="pre">RELEASED_IN</span></code> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MATCH</span> <span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="n">Movie</span><span class="p">)</span>
<span class="n">MERGE</span> <span class="p">(</span><span class="n">y</span><span class="p">:</span><span class="n">Year</span><span class="p">{</span><span class="n">released</span><span class="p">:</span><span class="n">m</span><span class="o">.</span><span class="n">released</span><span class="p">})</span>
<span class="n">MERGE</span> <span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">r</span><span class="p">:</span><span class="n">RELEASED_IN</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">RETURN</span> <span class="n">m</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">y</span>
</pre></div>
</div>
<p>Lorsqu’un noeud <code class="docutils literal notranslate"><span class="pre">Movie</span></code> correspond à un noeud <code class="docutils literal notranslate"><span class="pre">Year</span></code> qui n’existe pas encore, le noeud <code class="docutils literal notranslate"><span class="pre">Year</span></code> est créé. Cependant, dès lors que le noeud <code class="docutils literal notranslate"><span class="pre">Year</span></code> est créé,
les prochains noeuds <code class="docutils literal notranslate"><span class="pre">Movie</span></code> correspondant à ce noeud <code class="docutils literal notranslate"><span class="pre">Year</span></code> ne conduiront pas à la création de duplicatas : ils seront simplement connectés au noeud déjà
existant.</p>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Décomposer en autant de clause <code class="docutils literal notranslate"><span class="pre">MERGE</span></code> qu’il y a de noeuds et de relations dans le motif que vous souhaitez créer n’est pas toujours la bonne approche.
Voir l’exercice ci-dessous.</p>
</div>
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row sd-g-1 sd-g-xs-1 sd-g-sm-1 sd-g-md-1 sd-g-lg-1 docutils">
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
Exercice</div>
<ol class="arabic simple">
<li><p class="sd-card-text">Créez une relation <code class="docutils literal notranslate"><span class="pre">HAS_TOY</span></code> entre <code class="docutils literal notranslate"><span class="pre">Ozzy</span></code> et <code class="docutils literal notranslate"><span class="pre">Banana</span></code></p></li>
<li><p class="sd-card-text">Créez <code class="docutils literal notranslate"><span class="pre">Peter</span></code>, le propriétaire de <code class="docutils literal notranslate"><span class="pre">Ozzy</span></code>, âgé de <code class="docutils literal notranslate"><span class="pre">51</span></code> ans, et connectez les deux noeuds par une relation <code class="docutils literal notranslate"><span class="pre">HAS_DOG</span></code> avec pour propriété <code class="docutils literal notranslate"><span class="pre">since</span></code> qui vaut <code class="docutils literal notranslate"><span class="pre">2018</span></code></p></li>
<li><p class="sd-card-text">Créez pour chaque animal un noeud <code class="docutils literal notranslate"><span class="pre">HealthRecord</span></code> qui contiendra les informations du carnet de santé de l’animal.
Les deux noeuds sont à connecter avec une relation <code class="docutils literal notranslate"><span class="pre">HAS_HEALTH_RECORD</span></code>. Réfléchissez bien à la façon dont vous allez décomposer la requête.</p></li>
</ol>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="creer-un-index">
<h2><span class="section-number">2.4. </span>Créer un index<a class="headerlink" href="#creer-un-index" title="Link to this heading">#</a></h2>
<p>L’<strong>indexation</strong> améliore la <strong>vitesse d’exécution des requêtes en lecture</strong>.
Si certains <strong>champs</strong> sont <strong>fréquemment sollicités</strong>, <strong>créer un index sur ces champs</strong> permet d’améliorer les performances des requêtes qui font appel à ces champs.</p>
<p>Pour <strong>afficher les index</strong>, tapez :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SHOW</span> <span class="n">INDEXES</span>
</pre></div>
</div>
<p>Pour <strong>créer un index</strong>, utilisez :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="o">&lt;</span><span class="n">index_type</span><span class="o">&gt;</span> <span class="n">INDEX</span> <span class="o">&lt;</span><span class="n">index_name</span><span class="o">&gt;</span> <span class="n">FOR</span> <span class="o">&lt;</span><span class="n">node_or_relation</span><span class="o">&gt;</span> <span class="n">ON</span> <span class="o">&lt;</span><span class="n">key</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>où :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;index_type&gt;</span></code> : catégorie d’index</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;index_name&gt;</span></code> : nom donné à l’index, optionnel</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;node_or_relation&gt;</span></code> : <code class="docutils literal notranslate"><span class="pre">(&lt;node&gt;:&lt;Label&gt;)</span></code> ou <code class="docutils literal notranslate"><span class="pre">()-[&lt;relationship&gt;:&lt;type&gt;]-()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;key&gt;</span></code> : <code class="docutils literal notranslate"><span class="pre">&lt;node&gt;.&lt;key&gt;</span></code> ou <code class="docutils literal notranslate"><span class="pre">&lt;relationship&gt;.&lt;key&gt;</span></code>, propriété selon laquelle indexer</p></li>
</ul>
<p>Il existe quatre catégories d’index : <em>range</em> (plage), <em>text</em> (texte), <em>point</em> (localisation) et <em>lookup</em>.
Chaque index est optimisé pour certaines requêtes en particulier.
Dans ce cours, nous ne présenterons que la catégorie par défaut : les index de plage. Dans ce cas, vous pouvez omettre <code class="docutils literal notranslate"><span class="pre">&lt;index_type&gt;</span></code>.
Pour en savoir plus, voir la <a class="reference external" href="https://neo4j.com/docs/cypher-manual/current/indexes/search-performance-indexes/">documentation</a>.</p>
<p>Vous pouvez créer un index simple à partir d’une seule clé, ou un index composite à partir de plusieurs clés.</p>
<div class="tip admonition">
<p class="admonition-title">Example</p>
<p>Si cet index n’existait pas encore, vous auriez pu créer un index sur le titre des films ainsi :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="n">Movie</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">title</span>
</pre></div>
</div>
<p>Affichez les index. Si les requêtes simultanées sur le titre du film et l’année de sortie sont fréquentes, vous pouvez créer un index composite ainsi :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="n">Movie</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">released</span><span class="p">)</span>
</pre></div>
</div>
<p>Affichez les index. Exécutez l’instruction suivante et affichez de nouveau les index : que remarquez-vous ?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MATCH</span> <span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="n">Movie</span><span class="p">{</span><span class="n">title</span><span class="p">:</span><span class="s1">&#39;The Hobbit&#39;</span><span class="p">,</span> <span class="n">released</span><span class="p">:</span><span class="mi">2012</span><span class="p">})</span>
<span class="n">RETURN</span> <span class="n">m</span>
</pre></div>
</div>
</div>
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row sd-g-1 sd-g-xs-1 sd-g-sm-1 sd-g-md-1 sd-g-lg-1 docutils">
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
Exercice</div>
<ol class="arabic simple">
<li><p class="sd-card-text">Créez un index sur le nom des personnes</p></li>
<li><p class="sd-card-text">Créez un index sur la propriété <code class="docutils literal notranslate"><span class="pre">since</span></code> de la relation <code class="docutils literal notranslate"><span class="pre">HAS_DOG</span></code></p></li>
</ol>
</div>
</div>
</div>
</div>
</div>
<p>Pour en savoir plus, voir la <a class="reference external" href="https://neo4j.com/docs/cypher-manual/current/indexes/search-performance-indexes/managing-indexes/">documentation</a>.</p>
</section>
<section id="creer-une-contrainte">
<h2><span class="section-number">2.5. </span>Créer une contrainte<a class="headerlink" href="#creer-une-contrainte" title="Link to this heading">#</a></h2>
<p>Poser des <strong>contraintes</strong> permet de <strong>garantir la qualité et l’intégrité des données</strong>.
Quatre catégories de contraintes sont disponibles en Neo4j :</p>
<ul class="simple">
<li><p><strong>Contrainte d’unicité</strong> : Garantir que les valeurs combinées d’un ensemble de propriétés sont uniques</p></li>
<li><p><strong>Contrainte d’existence</strong> : Garantir qu’une propriété existe. Cette option n’est disponible que dans la version payante.</p></li>
<li><p><strong>Contrainte de type</strong> : Garantir qu’une propriété a le type requis (entiers, chaînes de caractères …).
Voir la <a class="reference external" href="https://neo4j.com/docs/cypher-manual/current/constraints/managing-constraints/#type-constraints-allowed-properties">documentation</a> pour connaître tous les types autorisés.
Cette option n’est disponible que dans la version payante.</p></li>
<li><p><strong>Contrainte clé</strong> : Garantir que toutes les propriétés existent et que les valeurs combinées d’un ensemble de propriétés sont uniques.
Cette option n’est disponible que dans la version payante.</p></li>
</ul>
<p>Pour <strong>afficher les contraintes</strong>, tapez :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SHOW</span> <span class="n">CONSTRAINTS</span>  
</pre></div>
</div>
<p>Pour <strong>créer une contrainte</strong>, utilisez :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">CONSTRAINT</span> <span class="o">&lt;</span><span class="n">constraint_name</span><span class="o">&gt;</span> <span class="n">FOR</span> <span class="o">&lt;</span><span class="n">node_or_relationship</span><span class="o">&gt;</span> <span class="n">REQUIRE</span> <span class="o">&lt;</span><span class="n">key</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">constraint_type</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>où :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;constraint_name&gt;</span></code> : nom donné à l’index, optionnel</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;node_or_relationship&gt;</span></code> : <code class="docutils literal notranslate"><span class="pre">(&lt;node&gt;:&lt;Label&gt;)</span></code> ou <code class="docutils literal notranslate"><span class="pre">()-[&lt;relationship&gt;:&lt;type&gt;]-()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;key&gt;</span></code> : propriété selon laquelle indexer</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;constraint_type&gt;</span></code> : <code class="docutils literal notranslate"><span class="pre">IS</span> <span class="pre">UNIQUE</span></code> (contrainte d’unicité), <code class="docutils literal notranslate"><span class="pre">IS</span> <span class="pre">NOT</span> <span class="pre">NULL</span></code> (contrainte d’existence), <code class="docutils literal notranslate"><span class="pre">IS</span> <span class="pre">::</span> <span class="pre">&lt;TYPE&gt;</span></code> (contrainte de type), <code class="docutils literal notranslate"><span class="pre">IS</span> <span class="pre">NODE</span> <span class="pre">KEY</span></code> ou <code class="docutils literal notranslate"><span class="pre">IS</span> <span class="pre">RELATIONSHIP</span> <span class="pre">KEY</span></code> (contrainte clé)</p></li>
</ul>
<div class="tip admonition">
<p class="admonition-title">Example</p>
<p>Pour forcer l’existence d’une propriété, tapez :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">:</span><span class="n">Person</span><span class="p">)</span><span class="w"> </span><span class="n">REQUIRE</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
</pre></div>
</div>
<p>Exécutez cette commande :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="p">(:</span><span class="n">Person</span><span class="p">{</span><span class="n">born</span><span class="p">:</span><span class="mi">1998</span><span class="p">})</span>
</pre></div>
</div>
<p>Si la contrainte n’existait pas déjà, vous auriez pu poser une contrainte d’unicité sur le nom des personne ainsi :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">CONSTRAINT</span> <span class="n">FOR</span> <span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="n">Person</span><span class="p">)</span> <span class="n">REQUIRE</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="n">IS</span> <span class="n">UNIQUE</span>
</pre></div>
</div>
</div>
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row sd-g-1 sd-g-xs-1 sd-g-sm-1 sd-g-md-1 sd-g-lg-1 docutils">
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
Exercice</div>
<ol class="arabic simple">
<li><p class="sd-card-text">Créez une contrainte sur le type de la propriété <code class="docutils literal notranslate"><span class="pre">since</span></code> de <code class="docutils literal notranslate"><span class="pre">HAS_DOG</span></code> et <code class="docutils literal notranslate"><span class="pre">HAS_CAT</span></code>. La valeur renseignée doit être <code class="docutils literal notranslate"><span class="pre">INTEGER</span></code>.</p></li>
<li><p class="sd-card-text">Essayez d’associer un autre chien nommé <code class="docutils literal notranslate"><span class="pre">Fido</span></code> à <code class="docutils literal notranslate"><span class="pre">Peter</span></code> en spécifiant <code class="docutils literal notranslate"><span class="pre">two</span> <span class="pre">thousand</span> <span class="pre">and</span> <span class="pre">ten</span></code> pour la propriété <code class="docutils literal notranslate"><span class="pre">since</span></code></p></li>
</ol>
</div>
</div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="01_cypher.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">1. </span>Langage Cypher</p>
      </div>
    </a>
    <a class="right-next"
       href="03_lecture.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">3. </span>C<strong>R</strong>UD : Lecture</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creer-un-noeud">2.1. Créer un noeud</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create">2.1.1. <code class="docutils literal notranslate"><span class="pre">CREATE</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#match-et-create">2.1.2. <code class="docutils literal notranslate"><span class="pre">MATCH</span></code> et <code class="docutils literal notranslate"><span class="pre">CREATE</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#merge">2.1.3. <code class="docutils literal notranslate"><span class="pre">MERGE</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creer-une-relation">2.2. Créer une relation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">2.2.1. <code class="docutils literal notranslate"><span class="pre">CREATE</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">2.2.2. <code class="docutils literal notranslate"><span class="pre">MATCH</span></code> et <code class="docutils literal notranslate"><span class="pre">CREATE</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#match-et-merge">2.2.3. <code class="docutils literal notranslate"><span class="pre">MATCH</span></code> et <code class="docutils literal notranslate"><span class="pre">MERGE</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creer-des-noeuds-et-des-relations">2.3. Créer des noeuds et des relations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creer-un-index">2.4. Créer un index</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creer-une-contrainte">2.5. Créer une contrainte</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Elena Berhocoïrigoin
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>