
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>7.1. Requêtes depuis Python : pymongo &#8212; MongoDB</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../_static/tabs.js?v=3ee01567"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/07_scripts_py';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7.2. Requêtes depuis R : mongolite" href="07_scripts_R.html" />
    <link rel="prev" title="7. Effectuer des requêtes depuis des programmes Python ou R" href="07_scripts.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="00_intro.html">
  
  
  
  
  
  
    <p class="title logo__title">MongoDB</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="00_intro.html">
                    MongoDB : Base de données NoSQL orientée documents
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Chapitres</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01_installation.html">1. Installation de MongoDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_creation.html">2. <strong>C</strong>RUD : Création</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_lecture.html">3. C<strong>R</strong>UD : Lecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_index.html">4. Titre 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_agreg.html">5. Titre 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_modif.html">6. Titre 5</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="07_scripts.html">7. Effectuer des requêtes depuis des programmes Python ou R</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">7.1. Requêtes depuis Python : <code class="docutils literal notranslate"><span class="pre">pymongo</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="07_scripts_R.html">7.2. Requêtes depuis R : <code class="docutils literal notranslate"><span class="pre">mongolite</span></code></a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/elenaberhoco/mongodb-trash" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/elenaberhoco/mongodb-trash/issues/new?title=Issue%20on%20page%20%2Fcontent/07_scripts_py.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/content/07_scripts_py.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Requêtes depuis Python : pymongo</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#presentation-et-installation">7.1.1. Présentation et installation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#connexion-serveur-base-de-donnees-et-collections">7.1.2. Connexion serveur, base de données et collections</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requetes">7.1.3. Requêtes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#requetes-simples-et-ses-specifictes">7.1.3.1. Requêtes simples et ses spécifictés</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#les-index">7.1.3.2. Les index</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#les-requetes-d-agregation">7.1.3.3. Les requêtes d’agrégation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#les-modifications">7.1.3.4. Les modifications</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pour-aller-plus-loin">7.1.4. Pour aller plus loin…</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#export-au-format-json">7.1.4.1. Export au format JSON</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercices-et-corrections">7.1.4.2. Exercices et corrections</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="requetes-depuis-python-pymongo">
<span id="sec-pymongo"></span><h1><span class="section-number">7.1. </span>Requêtes depuis Python : <code class="docutils literal notranslate"><span class="pre">pymongo</span></code><a class="headerlink" href="#requetes-depuis-python-pymongo" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>Auteurs : <strong>Pierre Cottais, Florian Guillaume, Tom Houée</strong></p></li>
</ul>
<p><strong>Comment faire pour effectuer les requêtes présentes dans les chapitres 1 à 6 avec <code class="docutils literal notranslate"><span class="pre">pymongo</span></code> ?</strong></p>
<p><strong>Sommaire :</strong></p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#partie1">Présentation et installation</a></p></li>
<li><p><a class="reference internal" href="#partie2">Connexion serveur, base de données et collections</a></p></li>
<li><p><a class="reference internal" href="#partie3">Requêtes</a><br />
3.1. <a class="reference internal" href="#partie31">Requêtes simple et ces spécifictés</a><br />
3.2. <a class="reference internal" href="#partie32">Les Index</a><br />
3.3. <a class="reference internal" href="#partie33">Requête d’aggrégation</a><br />
3.4. <a class="reference internal" href="#partie34">Requête de modifications</a></p></li>
<li><p><a class="reference internal" href="#partie4">Pour aller plus loin…</a><br />
4.1. <a class="reference internal" href="#partie41">Export au format JSON</a><br />
4.2. <a class="reference internal" href="#partie42">Exercices et corrections</a></p></li>
</ol>
<section id="presentation-et-installation">
<span id="partie1"></span><h2><span class="section-number">7.1.1. </span>Présentation et installation<a class="headerlink" href="#presentation-et-installation" title="Link to this heading">#</a></h2>
<p>PyMongo est une librairie Python contenant des outils pour travailler avec MongoDB et MongodbAtlas. PyMongo est maintenue par les développeurs de MongoDB officiel ce qui en fait la référence dans Python. Pour une documentation détaillée de la librairie, vous pouvez consulter la documentation :</p>
<p><strong><a class="reference external" href="https://pymongo.readthedocs.io/en/stable/">https://pymongo.readthedocs.io/en/stable/</a></strong></p>
<p>Pour installer la librairie, nous pouvons le faire avec la commande <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">pymongo</span></code>, dans un terminal tel que Anaconda Prompt par exemple.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pymongo</span> 
</pre></div>
</div>
</div>
</div>
<div class="admonition-remarque admonition">
<p class="admonition-title">Remarque</p>
<p>Cette librairie est déjà incluse dans la distribution Anaconda.</p>
</div>
</section>
<section id="connexion-serveur-base-de-donnees-et-collections">
<span id="partie2"></span><h2><span class="section-number">7.1.2. </span>Connexion serveur, base de données et collections<a class="headerlink" href="#connexion-serveur-base-de-donnees-et-collections" title="Link to this heading">#</a></h2>
<p>La première étape consiste à créer une connexion avec nos bases de données sur le serveur de MongoDB. Pour effectuer cette connexion, nous devons utiliser une URI qui est un URL. Il  existe différentes URI de connexion, mais ici, nous devons juste nous connecter à notre serveur local MongoDB. Pour voir les différents moyens de vous connecter à des serveurs extérieurs comme par exemple MongodbAtlas, voir la page :</p>
<p><strong><a class="reference external" href="https://docs.mongodb.com/manual/reference/connection-string/">https://docs.mongodb.com/manual/reference/connection-string/</a>.</strong></p>
<p>Ainsi notre URL de connexion est “mongodb://localhost:27017” avec notre :</p>
<ul class="simple">
<li><p>chaine de connexion : mongodb://</p></li>
<li><p>host: localHost</p></li>
<li><p>port: 27017.</p></li>
</ul>
<p>Pour utiliser cette URL nous utilisons la classe MongoClient de pymongo qui nous fait notre connexion.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import de notre Classe MongoClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymongo</span><span class="w">  </span><span class="kn">import</span> <span class="n">MongoClient</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">MongoClient</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">27017</span><span class="p">)</span>

<span class="c1"># ou bien </span>

<span class="n">db_uri</span> <span class="o">=</span> <span class="s2">&quot;mongodb://localhost:27017/&quot;</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">MongoClient</span><span class="p">(</span><span class="n">db_uri</span><span class="p">)</span>

<span class="c1"># affichage un objet</span>
<span class="nb">print</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MongoClient(host=[&#39;localhost:27017&#39;], document_class=dict, tz_aware=False, connect=True)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">client</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pymongo.synchronous.mongo_client.MongoClient&#39;&gt;
</pre></div>
</div>
</div>
</div>
<p>Ainsi, nous pouvons voir que la fonction créer un objet de class <code class="docutils literal notranslate"><span class="pre">pymongo.mongo_client.MongoClient</span></code> où nous retrouvons nos informations comme le host le port, etc…
La deuxième étape consiste à nous connecter à notre base de données et nos collections, nous prendons ici l’exemple de la base de données <code class="docutils literal notranslate"><span class="pre">food</span></code>:</p>
<div class="tip admonition">
<p class="admonition-title">Syntaxe</p>
<ul class="simple">
<li><p>Client.BasedeDonnee.Collection</p></li>
<li><p>Client[“BasedeDonnee”][“Collection”]</p></li>
</ul>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">db_name</span> <span class="o">=</span> <span class="s2">&quot;food&quot;</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="n">db_name</span><span class="p">]</span>

<span class="c1"># ou bien</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">food</span>

<span class="nb">print</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Database(MongoClient(host=[&#39;localhost:27017&#39;], document_class=dict, tz_aware=False, connect=True), &#39;food&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">db</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pymongo.synchronous.database.Database&#39;&gt;
</pre></div>
</div>
</div>
</div>
<p>Ainsi, il nous retourne un objet de classe <code class="docutils literal notranslate"><span class="pre">pymongo.database.Database</span></code>.<br />
Enfin, il ne nous reste plus qu’à récupérer la collection souhaitée. Cela est le même principe pour utiliser les collections et qui cette fois nous retourne un objet <code class="docutils literal notranslate"><span class="pre">pymongo.collection.Collection</span></code>. Ici, nous prenons l’exemple de la collection <code class="docutils literal notranslate"><span class="pre">NYfood</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coll_name</span> <span class="o">=</span> <span class="s2">&quot;NYfood&quot;</span>
<span class="n">coll</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">coll_name</span><span class="p">]</span>

<span class="c1"># même syntaxe qu&#39;auparavant</span>

<span class="n">coll</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">NYfood</span>

<span class="nb">print</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collection(Database(MongoClient(host=[&#39;localhost:27017&#39;], document_class=dict, tz_aware=False, connect=True), &#39;food&#39;), &#39;NYfood&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">coll</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pymongo.synchronous.collection.Collection&#39;&gt;
</pre></div>
</div>
</div>
</div>
<p>De plus, <code class="docutils literal notranslate"><span class="pre">pymongo</span></code> a une fonction bien pratique qui permet d’afficher la liste des collection contenues dans une base de données :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">list_collection_names</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p>En résumé, le package <code class="docutils literal notranslate"><span class="pre">pymongo</span></code> vous permet d’utiliser trois types d’objets via votre IDE python : les clients, les bases de données et les collections. Ces objets vont avoir des méthodes attitrées nous permettant d’effectuer des requêtes, nous les détaillerons dans la suite du cours.</p>
<div class="admonition-remarque admonition">
<p class="admonition-title">Remarque</p>
<p>Cela fonctionne comme un dictionnaire Python. Toutefois, si votre base contient des caractères spéciaux, espace ou autre, on vous conseille la première écriture : <code class="docutils literal notranslate"><span class="pre">Client[&quot;BasedeDonnee&quot;][&quot;Collection&quot;]</span></code>.</p>
</div>
</section>
<section id="requetes">
<span id="partie3"></span><h2><span class="section-number">7.1.3. </span>Requêtes<a class="headerlink" href="#requetes" title="Link to this heading">#</a></h2>
<p>Maintenant que nous avons fait nos connexions, il nous reste à voir comment effectuer des requêtes.</p>
<p><strong>Fonctionnement :</strong>
Le fonctionement est le même que sur l’interface MongoDB:</p>
<div class="tip admonition">
<p class="admonition-title">Syntaxe requête</p>
<ul class="simple">
<li><p>Client.BasedeDonne.nomDeLaCollection.requete()</p></li>
<li><p>Client[“BasedeDonnee”][“Collection”].requete()</p></li>
</ul>
</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Requête</p></th>
<th class="head"><p>Fonctionement</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>find()</p></td>
<td><p>Recherche de tous les individus selon les critères indiqués</p></td>
</tr>
<tr class="row-odd"><td><p>find_one()</p></td>
<td><p>Affichage du premier individu correspondant aux critères indiqués</p></td>
</tr>
</tbody>
</table>
</div>
<p>Mais le résultat est différent, il nous renvoie un objet de type <code class="docutils literal notranslate"><span class="pre">Cursor</span></code>. En effet, le module <code class="docutils literal notranslate"><span class="pre">pymongo</span></code> ne stockera pas les résultats dans une liste par souci de mémoire :</p>
<p>Par exemple, ici nous récupérons toutes les boulangeries de la collection <code class="docutils literal notranslate"><span class="pre">NYfood</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">NYfood</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;cuisine&quot;</span><span class="p">:</span> <span class="s2">&quot;Bakery&quot;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pymongo.synchronous.cursor.Cursor at 0x7fa677c9e460&gt;
</pre></div>
</div>
</div>
</div>
<p>Ainsi, pour accéder au contenu de la requête il nous faut parcourir l’objet renvoyé par celle-ci, comme un objet itérable en Python.
Exemple, on affiche les deux premiers individus issus de la requête.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">NYfood</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;cuisine&quot;</span><span class="p">:</span> <span class="s2">&quot;Bakery&quot;</span><span class="p">})</span>

<span class="c1"># afficher les 2 premiers individus</span>
<span class="k">for</span> <span class="n">rep</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">[:</span><span class="mi">2</span><span class="p">]:</span>    
  <span class="nb">print</span><span class="p">(</span><span class="n">rep</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Nous pouvons afficher l’ensemble des réponses, mais cela peut demander beaucoup de mémoire pour votre ordinateur en fonction de la requête demandée. Pour ce faire, on utilise la ligne suivante.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cursor</span><span class="p">))</span>
</pre></div>
</div>
<p>Il est donc préférable d’afficher les premiers résultats pour voir si votre requête est juste. Par exemple avec la requête <code class="docutils literal notranslate"><span class="pre">find_one()</span></code> affiche que le premier individu correspondant aux critères indiqués, comme par exemple, la première boulangerie de la collection :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">NYfood</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;cuisine&quot;</span><span class="p">:</span> <span class="s2">&quot;Bakery&quot;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<p>De plus, puisque notre réponse est un dictionnaire et que nous connaissons la structure, alors nous pouvons aller chercher les informations qui nous intéressent.
Ainsi, nous récupérons ci-dessous la localisation et les coordonnées du premier individu issu de notre requête :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">NYfood</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;cuisine&quot;</span><span class="p">:</span> <span class="s2">&quot;Bakery&quot;</span><span class="p">})</span>
<span class="n">cursor</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cursor</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;address&quot;</span><span class="p">][</span><span class="s2">&quot;loc&quot;</span><span class="p">][</span><span class="s2">&quot;coordinates&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">IndexError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">NYfood</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;cuisine&quot;</span><span class="p">:</span> <span class="s2">&quot;Bakery&quot;</span><span class="p">})</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">cursor</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="nb">print</span><span class="p">(</span><span class="n">cursor</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;address&quot;</span><span class="p">][</span><span class="s2">&quot;loc&quot;</span><span class="p">][</span><span class="s2">&quot;coordinates&quot;</span><span class="p">])</span>

<span class="ne">IndexError</span>: list index out of range
</pre></div>
</div>
</div>
</div>
<p><strong>Methodes :</strong></p>
<p>De plus, pour utiliser certaines méthodes sur nos requêtes comme <code class="docutils literal notranslate"><span class="pre">sort()</span></code>, c’est sensiblement la même syntaxe que MongoDB :</p>
<div class="tip admonition">
<p class="admonition-title">Syntaxe méthode</p>
<ul class="simple">
<li><p>Client.BasedeDonnee.Collection.requetes().methode()</p></li>
<li><p>Client[“BasedeDonnee”][“Collection”].requete().methode()</p></li>
</ul>
</div>
<p>Cependant, nous ne pouvons pas utiliser ces méthodes à l’objet <code class="docutils literal notranslate"><span class="pre">Cursor</span></code> car ces méthodes font partie intégrante de la requête.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Méthodes Python</p></th>
<th class="head"><p>Fonctionalité</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>sort()</p></td>
<td><p>Tri des individus</p></td>
</tr>
<tr class="row-odd"><td><p>count()</p></td>
<td><p>Comptage du nombre d’individus issus de la requête</p></td>
</tr>
<tr class="row-even"><td><p>limit()</p></td>
<td><p>Affichage des n premiers individus souhaités</p></td>
</tr>
<tr class="row-odd"><td><p>explain()</p></td>
<td><p>Permet d’obtenir un certain nombre d’informations sur le déroulement d’une requête</p></td>
</tr>
<tr class="row-even"><td><p>distinct()</p></td>
<td><p>Suppression des doublons</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Exemples :</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">NYfood</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;cuisine&quot;</span><span class="p">:</span> <span class="s2">&quot;Bakery&quot;</span><span class="p">})</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># Affiche les deux premiers résultats</span>
<span class="n">db</span><span class="o">.</span><span class="n">NYfood</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;cuisine&quot;</span><span class="p">:</span> <span class="s2">&quot;Bakery&quot;</span><span class="p">})</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="c1"># Trie les résultats par ordre décroissant par rapport à la variable name</span>
<span class="n">db</span><span class="o">.</span><span class="n">NYfood</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;cuisine&quot;</span><span class="p">:</span> <span class="s2">&quot;Bakery&quot;</span><span class="p">})</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="s2">&quot;executionStats&quot;</span><span class="p">)</span> <span class="c1"># Affiche les informations </span>
<span class="n">db</span><span class="o">.</span><span class="n">NYfood</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="s2">&quot;grades.grade&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;cuisine&quot;</span><span class="p">:</span> <span class="s2">&quot;Bakery&quot;</span><span class="p">})</span> <span class="c1">#  liste des notes attribuées aux boulangeries</span>
</pre></div>
</div>
<section id="requetes-simples-et-ses-specifictes">
<span id="partie31"></span><h3><span class="section-number">7.1.3.1. </span>Requêtes simples et ses spécifictés<a class="headerlink" href="#requetes-simples-et-ses-specifictes" title="Link to this heading">#</a></h3>
<p>L’utilisation de <code class="docutils literal notranslate"><span class="pre">pymongo</span></code> implique l’utilisation de certaines spécificités, deux principalement qui marquent une différence avec MongoDB.
Premièrement, nous avons une spécificité avec les opérateurs et les noms qui doivent toujours être entre guillemets comme par exemple <code class="docutils literal notranslate"><span class="pre">$gte</span></code>.</p>
<p>Exemple :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">NYfood</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$gte&quot;</span> <span class="p">:</span> <span class="s2">&quot;Y&quot;</span><span class="p">}})</span>
</pre></div>
</div>
</div>
</div>
<p>La deuxième spécificité concerne les dates. On utilise le module <code class="docutils literal notranslate"><span class="pre">datetime</span></code> et <code class="docutils literal notranslate"><span class="pre">pymongo</span></code> va de lui même effectuer la conversion au format “date de MongoDb”.
Exemple, liste des restaurants ayant au moins une note postérieure au 20 janvier 2015 :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;2015-01-20&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">db</span><span class="o">.</span><span class="n">NYfood</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;grades.date&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$gte&quot;</span><span class="p">:</span> <span class="n">date</span><span class="p">}})</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Astuce :</strong></p>
<p>Dans le but de rendre nos requêtes plus lisibles, il est possible de créer des variables Python qui correspondent aux conditions que nous utilisons pour nos requêtes.
Par exemple, nous voulons afficher la liste des restaurants qui vérifient l’une des conditions suivantes :</p>
<ul class="simple">
<li><p>le restaurant appartient aux quartiers de “Manhattan”</p></li>
<li><p>le restaurant est une boulangerie du Bronx commençant par la lettre “P”</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">db</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s2">&quot;food&quot;</span><span class="p">]</span>
<span class="n">coll</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s2">&quot;NYfood&quot;</span><span class="p">]</span>

<span class="c1"># première condition</span>
<span class="n">dico_cond1</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">dico_cond1</span><span class="p">[</span><span class="s2">&quot;borough&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Manhattan&quot;</span>

<span class="c1"># deuxième condition</span>
<span class="n">dico_cond2</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">dico_cond2</span><span class="p">[</span><span class="s2">&quot;borough&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Bronx&quot;</span>
<span class="n">dico_cond2</span><span class="p">[</span><span class="s2">&quot;cuisine&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Bakery&quot;</span>
<span class="n">dico_cond2</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;$gte&quot;</span><span class="p">:</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="s2">&quot;$lt&quot;</span><span class="p">:</span> <span class="s2">&quot;Q&quot;</span><span class="p">}</span>

<span class="c1"># Notre requête final</span>
<span class="n">req</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">req</span><span class="p">[</span><span class="s2">&quot;$or&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">dico_cond1</span><span class="p">,</span> <span class="n">dico_cond2</span><span class="p">]</span>

<span class="n">cursor</span> <span class="o">=</span> <span class="n">coll</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cursor</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Forme plus brutale :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cursorbis</span> <span class="o">=</span> <span class="n">coll</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;$or&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;borough&quot;</span><span class="p">:</span> <span class="s2">&quot;Manhattan&quot;</span><span class="p">},</span> 
			     <span class="p">{</span><span class="s2">&quot;cuisine&quot;</span><span class="p">:</span> <span class="s2">&quot;Bakery&quot;</span><span class="p">,</span> <span class="s2">&quot;borough&quot;</span><span class="p">:</span> <span class="s2">&quot;Bronx&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$gte&quot;</span><span class="p">:</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="s2">&quot;$lt&quot;</span><span class="p">:</span> <span class="s2">&quot;Q&quot;</span><span class="p">}}</span>
			     <span class="p">]})</span>
<span class="n">cursorbis</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cursorbis</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cursorbis</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>De plus, nous pouvons remarquer que ce sont deux listes <code class="docutils literal notranslate"><span class="pre">Cursor</span></code>, on peut donc tester l’égalité de leur contenu.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">cursorbis</span> <span class="o">==</span> <span class="n">cursor</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="les-index">
<span id="partie32"></span><h3><span class="section-number">7.1.3.2. </span>Les index<a class="headerlink" href="#les-index" title="Link to this heading">#</a></h3>
<p>Les index sont des structures de données spéciales qui stockent une petite partie de l’ensemble de données de la collection sous une forme facile à parcourir. L’index stocke la valeur d’un champ spécifique ou d’un ensemble de champs, triés par la valeur du champ. Ainsi, l’utilisation avec <code class="docutils literal notranslate"><span class="pre">pymongo</span></code> est la même qu’en mongoDB.</p>
<div class="tip admonition">
<p class="admonition-title">Syntaxe de requête d’index</p>
<ul class="simple">
<li><p>Client.BasedeDonnee.Collection.requeteIndex()</p></li>
<li><p>Client[“BasedeDonnee”][“Collection”].requeteIndex()</p></li>
</ul>
</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Requete</p></th>
<th class="head"><p>Fonctionement</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>index_information()</p></td>
<td><p>Pour obtenir la liste des index de la collection</p></td>
</tr>
<tr class="row-odd"><td><p>create_index()</p></td>
<td><p>Création d’un index</p></td>
</tr>
<tr class="row-even"><td><p>drop_index()</p></td>
<td><p>Suppression d’un index</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Exemple :</strong></p>
<p>L’ensemble des index de la collection <code class="docutils literal notranslate"><span class="pre">NYfood</span></code> :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">db</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s2">&quot;food&quot;</span><span class="p">]</span>
<span class="n">coll</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s2">&quot;NYfood&quot;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span>  <span class="ow">in</span> <span class="n">coll</span><span class="o">.</span><span class="n">index_information</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Nom : </span><span class="si">{}</span><span class="s2">, Valeur : </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Exemple de suppression ou de création d’un index :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">NYfood</span><span class="o">.</span><span class="n">drop_index</span><span class="p">(</span><span class="s2">&quot;borough_1&quot;</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">NYfood</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;borough_1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="les-requetes-d-agregation">
<span id="partie33"></span><h3><span class="section-number">7.1.3.3. </span>Les requêtes d’agrégation<a class="headerlink" href="#les-requetes-d-agregation" title="Link to this heading">#</a></h3>
<p>Les requêtes d’agrégation ont pour but de faire des calculs simples (agrégats) sur toute la collection ou seulement sur certains groupes. Pour ce faire, on utilise la méthode <code class="docutils literal notranslate"><span class="pre">aggregate()</span></code> .</p>
<div class="tip admonition">
<p class="admonition-title">Syntaxe de la requête d’aggregation</p>
<ul class="simple">
<li><p>Client.BasedeDonnee.Collection.aggregate()</p></li>
<li><p>Client[“BasedeDonnee”][“Collection”].aggregate()</p></li>
</ul>
</div>
<p>Dans l’exemple ci-dessous, on souhaite compter le nombre de restaurants dans la collection en les regroupant par quartier.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># aggrégation</span>
<span class="n">cursor_agreg</span> <span class="o">=</span> <span class="n">coll</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
  <span class="p">{</span><span class="s2">&quot;$group&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;$borough&quot;</span><span class="p">,</span>
              <span class="s2">&quot;nb_restos&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$sum&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>
  <span class="p">}</span>
<span class="p">])</span>

<span class="c1"># affichage</span>
<span class="k">for</span> <span class="n">agreg</span> <span class="ow">in</span> <span class="n">cursor_agreg</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">agreg</span><span class="p">[</span><span class="s2">&quot;nb_restos&quot;</span><span class="p">],</span> <span class="s2">&quot;restaurants dans le quartier&quot;</span><span class="p">,</span> <span class="n">agreg</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Bonus, exemple d’utilisation du résultat d’une agrégation</strong></p>
<p>La méthode <code class="docutils literal notranslate"><span class="pre">aggregate</span></code> nous permets de faire des calculs, des regroupement, etc… Mais on a envie d’exploiter ce résultat en créant un graphique ou en le stockant dans un fichier.<br />
Création d’un graphique montrant, pour chaque valeur possible de note, le nombre de fois qu’elle a été attribuée.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">cursor_agrr</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">food</span><span class="o">.</span><span class="n">NYfood</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span>
                                              <span class="p">{</span><span class="s2">&quot;$unwind&quot;</span><span class="p">:</span> <span class="s2">&quot;$grades&quot;</span><span class="p">},</span>
                                              <span class="p">{</span><span class="s2">&quot;$group&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;$grades.grade&quot;</span><span class="p">,</span> <span class="s2">&quot;nb&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$sum&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}}</span>
                                            <span class="p">])</span>

<span class="c1"># récupérer nos informations                                  </span>
<span class="n">l_nb</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">l_grade</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">cursor_agrr</span> <span class="p">:</span>
    <span class="n">l_nb</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s2">&quot;nb&quot;</span><span class="p">])</span>
    <span class="n">l_grade</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">])</span>

<span class="c1"># Création du graphe</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">l_grade</span><span class="p">,</span> <span class="n">l_nb</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Note&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Number of times assigned to a note&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="les-modifications">
<span id="partie34"></span><h3><span class="section-number">7.1.3.4. </span>Les modifications<a class="headerlink" href="#les-modifications" title="Link to this heading">#</a></h3>
<p>Contrairement aux requêtes d’interrogation, les requêtes de modification peuvent modifier la base de données. Avec la librairie <code class="docutils literal notranslate"><span class="pre">pymongo</span></code> l’écriture est la même qu’en MongoDB.</p>
<div class="tip admonition">
<p class="admonition-title">Syntaxe de requête de modifications</p>
<ul class="simple">
<li><p>Client.BasedeDonnee.Collection.requeteModification()</p></li>
<li><p>Client[“BasedeDonnee”][“Collection”].requeteModification()</p></li>
</ul>
</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Requete</p></th>
<th class="head"><p>Fonctionement</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>insert_one()</p></td>
<td><p>Insertion d’un seul document</p></td>
</tr>
<tr class="row-odd"><td><p>insert_many()</p></td>
<td><p>Insertion d’une liste de documents</p></td>
</tr>
<tr class="row-even"><td><p>delete_one()</p></td>
<td><p>Suppression d’un document</p></td>
</tr>
<tr class="row-odd"><td><p>delete_many()</p></td>
<td><p>Suppression d’une liste de documents</p></td>
</tr>
<tr class="row-even"><td><p>update_one()</p></td>
<td><p>Modification d’un document</p></td>
</tr>
<tr class="row-odd"><td><p>update_many()</p></td>
<td><p>Modification d’une liste de documents</p></td>
</tr>
<tr class="row-even"><td><p>replace_one()</p></td>
<td><p>Remplacement d’un document</p></td>
</tr>
</tbody>
</table>
</div>
<p>Exemple d’insertion d’un document dans la collection <code class="docutils literal notranslate"><span class="pre">NYfood</span></code> :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">NYfood</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span>
  <span class="p">{</span>
	<span class="s2">&quot;_id&quot;</span> <span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;nouvel_id_resto&quot;</span><span class="p">),</span>
	<span class="s2">&quot;address&quot;</span> <span class="p">:</span> <span class="p">{</span>
    	<span class="s2">&quot;building&quot;</span> <span class="p">:</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span>
    	<span class="s2">&quot;loc&quot;</span> <span class="p">:</span> <span class="p">{</span>
        	<span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;Point&quot;</span><span class="p">,</span>
        	<span class="s2">&quot;coordinates&quot;</span> <span class="p">:</span> <span class="p">[</span>
            	<span class="o">-</span><span class="mf">1.6773</span><span class="p">,</span>
            	<span class="mf">48.111</span>
        	<span class="p">]</span>
    	<span class="p">},</span>
    	<span class="s2">&quot;street&quot;</span> <span class="p">:</span> <span class="s2">&quot;Rue du Vau Saint-Germainl&quot;</span><span class="p">,</span>
    	<span class="s2">&quot;zipcode&quot;</span> <span class="p">:</span> <span class="s2">&quot;35000&quot;</span>
	<span class="p">},</span>
	<span class="s2">&quot;borough&quot;</span> <span class="p">:</span> <span class="s2">&quot;KilKenny&#39;s Pub&quot;</span><span class="p">,</span>
	<span class="s2">&quot;cuisine&quot;</span> <span class="p">:</span> <span class="s2">&quot;Bar, Pub&quot;</span><span class="p">,</span>
	<span class="s2">&quot;grades&quot;</span> <span class="p">:</span> <span class="p">[</span>
    	<span class="p">{</span>
        	<span class="s2">&quot;date&quot;</span> <span class="p">:</span> <span class="n">ISODate</span><span class="p">(</span><span class="s2">&quot;2021-04-08T00:00:00.000Z&quot;</span><span class="p">),</span>
        	<span class="s2">&quot;grade&quot;</span> <span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span>
        	<span class="s2">&quot;score&quot;</span> <span class="p">:</span> <span class="mi">9</span>
    	<span class="p">}</span>
	<span class="p">],</span>
	<span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;KilKenny&#39;s Pub&quot;</span><span class="p">,</span>
	<span class="s2">&quot;restaurant_id&quot;</span> <span class="p">:</span> <span class="s2">&quot;99999999&quot;</span>
<span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition-remarque admonition">
<p class="admonition-title">Remarque</p>
<p>Si la collection <code class="docutils literal notranslate"><span class="pre">NYfood</span></code> n’existe pas encore dans la base de données, elle sera automatiquement créée lors de l’insertion d’un document dans cette nouvelle collection. La méthode <code class="docutils literal notranslate"><span class="pre">db.create_collection()</span></code> est donc facultative.</p>
</div>
</section>
</section>
<section id="pour-aller-plus-loin">
<span id="partie4"></span><h2><span class="section-number">7.1.4. </span>Pour aller plus loin…<a class="headerlink" href="#pour-aller-plus-loin" title="Link to this heading">#</a></h2>
<section id="export-au-format-json">
<span id="partie41"></span><h3><span class="section-number">7.1.4.1. </span>Export au format JSON<a class="headerlink" href="#export-au-format-json" title="Link to this heading">#</a></h3>
<p>Les résultats obtenus après une requête peuvent être conservés dans le but d’un projet ou d’une étude quelconque. Ainsi, nous vous proposons d’enregistrer vos requêtes sous la forme d’un format JSON.</p>
<p>Remarque : le module JSON ne peut écrire dans un fichier avec des données de types classiques comme liste, dictionnaire, nombre, caractère. En l’occurrence, un identifiant qui aura une classe “ObjectID” ne pourra être écrit dans le fichier directement, de même pour les objets <code class="docutils literal notranslate"><span class="pre">datetime</span></code>. Nous nous devons donc de les convertir en chaîne de caractères au préalable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">NYfood</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;cuisine&quot;</span><span class="p">:</span> <span class="s2">&quot;Bakery&quot;</span><span class="p">})</span>

<span class="n">cursor</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cursor</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>

<span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
    <span class="n">elt</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">elt</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">grade</span> <span class="ow">in</span> <span class="n">elt</span><span class="p">[</span><span class="s2">&quot;grades&quot;</span><span class="p">]:</span>
        <span class="n">grade</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grade</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-</span><span class="si">%d</span><span class="s2">-%m&quot;</span><span class="p">)</span>
        
<span class="n">dico</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Bakery&quot;</span> <span class="p">:</span> <span class="n">cursor</span><span class="p">}</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;Bakery&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">jsonFile</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">dico</span><span class="p">,</span> <span class="n">jsonFile</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercices-et-corrections">
<span id="partie42"></span><h3><span class="section-number">7.1.4.2. </span>Exercices et corrections<a class="headerlink" href="#exercices-et-corrections" title="Link to this heading">#</a></h3>
<p>Ici nous restons dans la base <code class="docutils literal notranslate"><span class="pre">food</span></code> :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">db</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s2">&quot;food&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p><strong>Question 1</strong></p>
<p>Dans la collection <code class="docutils literal notranslate"><span class="pre">NYfood</span></code>, trouvez les restaurants qui n’ont reçu que des notes égales à B.</p>
<div class="dropdown admonition">
<p class="admonition-title">Cliquez pour montrer la solution</p>
</div>
<p><strong>Question 2</strong></p>
<p>Dans la collection <code class="docutils literal notranslate"><span class="pre">NYfood</span></code>, on vous demande de conserver les quartiers ayant moins de 1000 restaurants.</p>
<div class="dropdown admonition">
<p class="admonition-title">Cliquez pour montrer la solution</p>
</div>
<p><strong>Question 3</strong></p>
<p>Dans la collection <code class="docutils literal notranslate"><span class="pre">NYfood</span></code>, trouvez tous les restaurants qui possède le mot “Pizza” dans le nom de l’enseigne.</p>
<div class="dropdown admonition">
<p class="admonition-title">Cliquez pour montrer la solution</p>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="07_scripts.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">7. </span>Effectuer des requêtes depuis des programmes Python ou R</p>
      </div>
    </a>
    <a class="right-next"
       href="07_scripts_R.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">7.2. </span>Requêtes depuis R : <code class="docutils literal notranslate"><span class="pre">mongolite</span></code></p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#presentation-et-installation">7.1.1. Présentation et installation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#connexion-serveur-base-de-donnees-et-collections">7.1.2. Connexion serveur, base de données et collections</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requetes">7.1.3. Requêtes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#requetes-simples-et-ses-specifictes">7.1.3.1. Requêtes simples et ses spécifictés</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#les-index">7.1.3.2. Les index</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#les-requetes-d-agregation">7.1.3.3. Les requêtes d’agrégation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#les-modifications">7.1.3.4. Les modifications</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pour-aller-plus-loin">7.1.4. Pour aller plus loin…</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#export-au-format-json">7.1.4.1. Export au format JSON</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercices-et-corrections">7.1.4.2. Exercices et corrections</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Unknown
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>