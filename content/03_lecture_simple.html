
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>3.1. Requête simple &#8212; Neo4j</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../_static/tabs.js?v=3ee01567"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/03_lecture_simple';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3.2. Requête complexe" href="03_lecture_complexe.html" />
    <link rel="prev" title="3. CRUD : Lecture" href="03_lecture.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="00_intro.html">
  
  
  
  
  
  
    <p class="title logo__title">Neo4j</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="00_intro.html">
                    Neo4j : Base de données NoSQL orientée graphe
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Chapitres</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01_cypher.html">1. Langage Cypher</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_creation.html">2. <strong>C</strong>RUD : Création</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="03_lecture.html">3. C<strong>R</strong>UD : Lecture</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">3.1. Requête simple</a></li>
<li class="toctree-l2"><a class="reference internal" href="03_lecture_complexe.html">3.2. Requête complexe</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="04_modification.html">4. CR<strong>U</strong>D : Modification</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_suppression.html">5. CRU<strong>D</strong> : Suppression</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/elenaberhoco/neo4j" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/elenaberhoco/neo4j/issues/new?title=Issue%20on%20page%20%2Fcontent/03_lecture_simple.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/content/03_lecture_simple.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Requête simple</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requete-sur-les-noeuds">3.1.1. Requête sur les noeuds</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requete-sur-les-relations">3.1.2. Requête sur les relations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requete-a-partir-de-motifs-complexes">3.1.3. Requête à partir de motifs complexes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requete-a-plusieurs-motifs">3.1.4. Requête à plusieurs motifs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quelques-fonctions-utiles">3.1.5. Quelques fonctions utiles</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercice">3.1.6. Exercice</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="requete-simple">
<h1><span class="section-number">3.1. </span>Requête simple<a class="headerlink" href="#requete-simple" title="Link to this heading">#</a></h1>
<p>source : <a class="reference external" href="https://neo4j.com/docs/cypher-manual/current/clauses/match/">documentation Neo4j</a></p>
<p>Dans Cypher, le comportement d’une requête est défini par ses <strong>clauses</strong>, i.e les différentes étapes qui la composent.
Chaque clause prend l’<strong>état actuel du graphe</strong> et un tableau de <strong>résultats intermédiaires</strong>, les traite,
puis transmet l’<strong>état mis à jour</strong> du graphe et les <strong>résultats</strong> à la <strong>clause suivante</strong>.</p>
<p>La première clause d’une instruction Cypher est généralement <code class="docutils literal notranslate"><span class="pre">MATCH</span></code>.
Elle permet de <strong>spécifier les motifs à rechercher dans le graphe</strong> de données. La syntaxe générale est la suivante :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">MATCH</span><span class="w"> </span><span class="p">...</span><span class="w">   </span>
<span class="p">...</span><span class="w"> </span>
<span class="k">RETURN</span><span class="w"> </span><span class="p">...</span><span class="w">  </span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">RETURN</span></code> permet de définir les noeuds, les relations et les propriétés à inclure dans le <strong>résultat de la requête</strong>.</p>
<div class="tip admonition">
<p class="admonition-title">Example</p>
<p>Nous allons utiliser l’un des jeux de données mis à disposition par Neo4j.
Rendez-vous sur <a class="reference external" href="https://sandbox.neo4j.com/">https://sandbox.neo4j.com/</a>. Créez un compte.
Créez un nouveau projet et cliquez sur la tuile “Movies” dans la section “Pre-built data”.</p>
</div>
<section id="requete-sur-les-noeuds">
<h2><span class="section-number">3.1.1. </span>Requête sur les noeuds<a class="headerlink" href="#requete-sur-les-noeuds" title="Link to this heading">#</a></h2>
<p>Dans Neo4j, vous pouvez effectuer des requêtes à partir des <strong>labels</strong> et des <strong>propriétés</strong> des <strong>noeuds</strong>.
La syntaxe est la suivante :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MATCH</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">node</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">Label</span><span class="o">&gt;</span><span class="p">{</span><span class="o">&lt;</span><span class="n">key</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span><span class="p">,</span><span class="o">...</span><span class="p">})</span>                           
<span class="n">RETURN</span> <span class="o">...</span>  
</pre></div>
</div>
<p>où :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;node&gt;</span></code> : nom de la variable qui pointera vers les noeuds sélectionnés, si besoin</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;Label&gt;</span></code> : label</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{&lt;key&gt;:&lt;value&gt;,...}</span></code> : propriétés</p></li>
</ul>
<p>Il est nécessaire de <strong>lier</strong> les <strong>noeuds sélectionnés</strong> à une <strong>variable</strong> si vous souhaitez <strong>y accéder dans les clauses suivantes</strong>, et notamment dans <code class="docutils literal notranslate"><span class="pre">RETURN</span></code>.
Les noms des variables peuvent être des lettres ou des mots isolés, et doivent être écrites en <strong>minuscules</strong>.</p>
<p>Il est possible d’<strong>accéder aux propriétés d’un noeud</strong> via la syntaxe : <code class="docutils literal notranslate"><span class="pre">&lt;node&gt;.&lt;key&gt;</span></code>.
Cette syntaxe est utile lorsque vous ne souhaitez retourner que certaines informations.
Utilisez une <strong>virgule</strong> pour lister toutes les informations que vous souhaitez renvoyer avec <code class="docutils literal notranslate"><span class="pre">RETURN</span></code>.
Vous pouvez utiliser <code class="docutils literal notranslate"><span class="pre">AS</span></code> pour formatter le résultat dans <code class="docutils literal notranslate"><span class="pre">RETURN</span></code>.</p>
<p>Si <strong>aucune condition</strong> sur les labels ou les propriétés n’est spécifiée, tous les noeuds du graphe sont retournés :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="k">RETURN</span><span class="w"> </span><span class="n">n</span>
</pre></div>
</div>
<p>Vous pouvez filtrer les noeuds à partir de leurs <strong>labels</strong>. La syntaxe est la suivante : <code class="docutils literal notranslate"><span class="pre">(&lt;node&gt;:&lt;Label&gt;)</span></code>.<br />
Vous pouvez spécifier <strong>plusieurs labels</strong> à l’aide des opérateurs suivants :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">|</span></code> qui correspond au <strong>OU</strong> logique, syntaxe : <code class="docutils literal notranslate"><span class="pre">(&lt;node&gt;:&lt;Label1&gt;|&lt;Label2&gt;...)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&amp;</span></code> qui correspond au <strong>ET</strong> logique, syntaxe : <code class="docutils literal notranslate"><span class="pre">(&lt;node&gt;:&lt;Label1&gt;&amp;&lt;Label2&gt;...)</span></code></p></li>
</ul>
<p>Il est possible de <strong>combiner les deux</strong>, en écrivant par exemple : <code class="docutils literal notranslate"><span class="pre">(&lt;node&gt;:(&lt;Label1&gt;&amp;&lt;Label2&gt;)|&lt;Label3&gt;)</span></code>.<br />
Vous pouvez spécifier les <strong>labels à exclure</strong> à l’aide de <code class="docutils literal notranslate"><span class="pre">!</span></code>. La syntaxe est la suivante : <code class="docutils literal notranslate"><span class="pre">(&lt;node&gt;:!&lt;Label&gt;)</span></code>.</p>
<div class="tip admonition">
<p class="admonition-title">Example</p>
<p><strong>Exemple n°1</strong>: Pour retourner le titre (<code class="docutils literal notranslate"><span class="pre">title</span></code>) de tous les films (<code class="docutils literal notranslate"><span class="pre">Movie</span></code>) du jeu de données, tapez :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">movie</span><span class="p">:</span><span class="n">Movie</span><span class="p">)</span>
<span class="k">RETURN</span><span class="w"> </span><span class="n">movie</span><span class="p">.</span><span class="n">title</span>
</pre></div>
</div>
<p><strong>Exemple n°2</strong>: Pour retourner à la fois le titre de tous les films et le nom (<code class="docutils literal notranslate"><span class="pre">name</span></code>) de toutes les personnes (<code class="docutils literal notranslate"><span class="pre">Person</span></code>) du jeu de données, puis renommer les colonnes du tableau renvoyé, tapez :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">:</span><span class="n">Movie</span><span class="o">|</span><span class="n">Person</span><span class="p">)</span>
<span class="k">RETURN</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">title</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">name</span>
</pre></div>
</div>
<p><strong>Exemple n°3</strong>: Pour exclure les films du résultat, tapez :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">:</span><span class="o">!</span><span class="n">Movie</span><span class="p">)</span>
<span class="k">RETURN</span><span class="w"> </span><span class="n">n</span>
</pre></div>
</div>
</div>
<p>Vous pouvez filtrer les noeuds à partir de leurs labels et de leurs <strong>propriétés</strong>. La syntaxe est la suivante : <code class="docutils literal notranslate"><span class="pre">(&lt;node&gt;:&lt;Label&gt;{&lt;key&gt;:&lt;value&gt;,...})</span></code></p>
<div class="tip admonition">
<p class="admonition-title">Example</p>
<p>La commande pour retourner toutes les personnes qui se nomment <code class="docutils literal notranslate"><span class="pre">Tom</span> <span class="pre">Hanks</span></code> est la suivante :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MATCH</span> <span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="n">Person</span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="s1">&#39;Tom Hanks&#39;</span><span class="p">})</span>
<span class="n">RETURN</span> <span class="n">p</span>
</pre></div>
</div>
</div>
</section>
<section id="requete-sur-les-relations">
<h2><span class="section-number">3.1.2. </span>Requête sur les relations<a class="headerlink" href="#requete-sur-les-relations" title="Link to this heading">#</a></h2>
<p>Dans Neo4j, vous pouvez rechercher des <strong>motifs</strong> dans le graphe. Les motifs sont une <strong>combinaison de noeuds et de relations</strong>.
Toute requête impliquant une <strong>relation</strong> doit <strong>obligatoirement</strong> rattacher la relation à deux noeuds : un <strong>noeud de départ</strong> et un <strong>noeud d’arrivée</strong>.<br />
La syntaxe générale est la suivante (l’orientation de la flèche est purement illustrative) :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MATCH</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">start_node</span><span class="o">&gt;</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="o">&lt;</span><span class="n">relationship</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">TYPE</span><span class="o">&gt;</span><span class="p">{</span><span class="o">&lt;</span><span class="n">key</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span><span class="p">,</span><span class="o">...</span><span class="p">}]</span><span class="o">-&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="n">end_node</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">RETURN</span> <span class="o">...</span>
</pre></div>
</div>
<p>où :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;start_node&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;end_node&gt;</span></code> : noeuds tels que définis à la section précédente</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;relationship&gt;</span></code> : nom de la variable qui pointera vers les relations sélectionnées, si besoin</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;TYPE&gt;</span></code> : type de la relation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{&lt;key&gt;:&lt;value&gt;,...}</span></code> : propriétés</p></li>
</ul>
<p>Comme pour les noeuds, si vous souhaitez <strong>accéder aux relations sélectionnées</strong> par votre requête <strong>dans les clauses suivantes</strong>,
il est nécessaire de les lier à une <strong>variable</strong>.</p>
<p>Il est possible d’accéder aux <strong>propriétés</strong> d’une relation via la syntaxe : <code class="docutils literal notranslate"><span class="pre">&lt;relationship&gt;.&lt;key&gt;</span></code>.
Vous pouvez ne spécifier <strong>aucune direction</strong> pour la ou les relations en écrivant : <code class="docutils literal notranslate"><span class="pre">--</span></code>.
La <strong>direction</strong> d’une relation peut être spécifiée à l’aide d’une flèche : <code class="docutils literal notranslate"><span class="pre">--&gt;</span></code> ou <code class="docutils literal notranslate"><span class="pre">&lt;--</span></code>.
Vous pouvez utiliser <code class="docutils literal notranslate"><span class="pre">AS</span></code> pour formatter le résultat. Vous pouvez <strong>spécifier plusieurs types</strong> simultanément à l’aide de l’opérateur <code class="docutils literal notranslate"><span class="pre">|</span></code> (OU logique).
Vous pouvez spécifier les <strong>types à exclure</strong> à l’aide de <code class="docutils literal notranslate"><span class="pre">!</span></code>.</p>
<p>Si <strong>aucune condition</strong> sur le type ou les propriétés de la relation n’est spécifiée, <strong>toutes les relations connectées à un ou plusieurs noeuds</strong> sont retournées :</p>
<div class="tip admonition">
<p class="admonition-title">Example</p>
<p><strong>Exemple n°1</strong>: Pour renvoyer tous les noeuds connectés au noeud de la réalisatrice <code class="docutils literal notranslate"><span class="pre">Lana</span> <span class="pre">Wachowski</span></code> quelque soit la direction de la relation, tapez :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MATCH</span> <span class="p">(:</span><span class="n">Person</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="s1">&#39;Lana Wachowski&#39;</span><span class="p">})</span><span class="o">--</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">RETURN</span> <span class="n">n</span> <span class="n">AS</span> <span class="n">connectedNodes</span>
</pre></div>
</div>
<p>Notez que nous n’avons pas défini de variable pour la relation ni pour le noeud de la réalisatrice, car seul les noeuds reliés au noeud de <code class="docutils literal notranslate"><span class="pre">Lana</span> <span class="pre">Wachowski</span></code> nous intéressaient.</p>
<p><strong>Exemple n°2</strong>: Pour renvoyer simultanément le noeud de la réalisatrive <code class="docutils literal notranslate"><span class="pre">Lana</span> <span class="pre">Wachowski</span></code>, toutes les relations qui partent ou pointent vers ce noeud, ainsi que tous les noeuds connectés, tapez :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MATCH</span> <span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="n">Person</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="s1">&#39;Lana Wachowski&#39;</span><span class="p">})</span><span class="o">-</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">RETURN</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">n</span>
</pre></div>
</div>
<p><strong>Exemple n°3</strong>: Pour trouver tous les noeuds labellisés <code class="docutils literal notranslate"><span class="pre">Movie</span></code> connectés à <code class="docutils literal notranslate"><span class="pre">Lana</span> <span class="pre">Wachowski</span></code> par une relation sortante, vous pouvez tapez :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MATCH</span> <span class="p">(:</span><span class="n">Person</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="s1">&#39;Lana Wachowski&#39;</span><span class="p">})</span><span class="o">--&gt;</span><span class="p">(</span><span class="n">movie</span><span class="p">:</span><span class="n">Movie</span><span class="p">)</span>
<span class="n">RETURN</span> <span class="n">movie</span><span class="o">.</span><span class="n">title</span> <span class="n">AS</span> <span class="n">movieTitle</span>
</pre></div>
</div>
</div>
<p>Vous pouvez également affiner la rechercher en spécifiant un <strong>type</strong> et des <strong>propriétés</strong> pour les relations. La syntaxe est la suivante : <code class="docutils literal notranslate"><span class="pre">[&lt;relationship&gt;:&lt;TYPE&gt;{&lt;key&gt;:&lt;value&gt;,...}]</span></code>.</p>
<div class="tip admonition">
<p class="admonition-title">Example</p>
<p><strong>Exemple n°1</strong> : La commande suivante permet d’extraire le nom des acteurs qui ont joué (<code class="docutils literal notranslate"><span class="pre">ACTED_IN</span></code>) dans le film <code class="docutils literal notranslate"><span class="pre">Charlie</span> <span class="pre">Wilson's</span> <span class="pre">War</span></code> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MATCH</span> <span class="p">(:</span><span class="n">Movie</span> <span class="p">{</span><span class="n">title</span><span class="p">:</span> <span class="s2">&quot;Charlie Wilson&#39;s War&quot;</span><span class="p">})</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">ACTED_IN</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">actor</span><span class="p">:</span><span class="n">Person</span><span class="p">)</span>
<span class="n">RETURN</span> <span class="n">actor</span><span class="o">.</span><span class="n">name</span> <span class="n">AS</span> <span class="n">actor</span>
</pre></div>
</div>
<p><strong>Exemple n°2</strong> : Pour retourner le nom de l’acteur qui a joué le personnage <code class="docutils literal notranslate"><span class="pre">Kevin</span> <span class="pre">Lomax</span></code> (<code class="docutils literal notranslate"><span class="pre">role</span></code>) dans un film, ainsi que le titre du film, tapez :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MATCH</span> <span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="n">Person</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">ACTED_IN</span> <span class="p">{</span><span class="n">roles</span><span class="p">:</span><span class="s1">&#39;Kevin Lomax&#39;</span><span class="p">}]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">:</span><span class="n">Movie</span><span class="p">)</span>
<span class="n">RETURN</span> <span class="n">a</span><span class="o">.</span><span class="n">name</span> <span class="n">AS</span> <span class="n">name</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">title</span> <span class="n">AS</span> <span class="n">title</span>
</pre></div>
</div>
<p>Cette commande ne fonctionnera pas avec la base de données utilisée dans ce chapitre, car <code class="docutils literal notranslate"><span class="pre">role</span></code> est une liste.
La bonne façon de procéder est celle présentée dans le bloc suivant, qui utilise <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> et <code class="docutils literal notranslate"><span class="pre">IN</span></code>, clauses qui seront introduites dans le chapitre 3.2.</p>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Exécutez la commande suivante :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MATCH</span> <span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">r</span><span class="p">:</span><span class="n">ACTED_IN</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="n">WHERE</span> <span class="s1">&#39;Kevin Lomax&#39;</span> <span class="n">IN</span> <span class="n">r</span><span class="o">.</span><span class="n">roles</span>
<span class="n">RETURN</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>
</pre></div>
</div>
<p>Que remarquez-vous ? Ne pas spécifier de direction dégrade les performances : Neo4j doit traverser le graphe dans les deux sens.
De façon générale, soyez le plus précis possible dans vos requêtes pour améliorer les performances.</p>
</div>
</section>
<section id="requete-a-partir-de-motifs-complexes">
<h2><span class="section-number">3.1.3. </span>Requête à partir de motifs complexes<a class="headerlink" href="#requete-a-partir-de-motifs-complexes" title="Link to this heading">#</a></h2>
<p>Il est possible de construire des <strong>motifs plus complexes</strong> dans le graphe de données : vous pouvez inclure <strong>plusieurs relations</strong> et <strong>plusieurs noeuds</strong> dans le motif de requête.</p>
<div class="tip admonition">
<p class="admonition-title">Example</p>
<p><strong>Exemple n°1</strong> : Dans quel(s) film(s) réalisé(s) (<code class="docutils literal notranslate"><span class="pre">DIRECTED</span></code>) par <code class="docutils literal notranslate"><span class="pre">Vincent</span> <span class="pre">Ward</span></code> l’acteur <code class="docutils literal notranslate"><span class="pre">Max</span> <span class="pre">von</span> <span class="pre">Sydow</span></code> a-t-il joué ?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MATCH</span> <span class="p">(:</span><span class="n">Person</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="s1">&#39;Max von Sydow&#39;</span><span class="p">})</span><span class="o">-</span><span class="p">[:</span><span class="n">ACTED_IN</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">movie</span><span class="p">:</span><span class="n">Movie</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">DIRECTED</span><span class="p">]</span><span class="o">-</span><span class="p">(:</span><span class="n">Person</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="s1">&#39;Vincent Ward&#39;</span><span class="p">})</span>
<span class="n">RETURN</span> <span class="n">movie</span><span class="o">.</span><span class="n">title</span> <span class="n">AS</span> <span class="n">title</span>
</pre></div>
</div>
<p><strong>Exemple n°2</strong> : Avec quel(s) réalisateur(s) l’acteur <code class="docutils literal notranslate"><span class="pre">Max</span> <span class="pre">von</span> <span class="pre">Sydow</span></code> a-t-il travaillé ?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MATCH</span> <span class="p">(:</span><span class="n">Person</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="s1">&#39;Max von Sydow&#39;</span><span class="p">})</span><span class="o">-</span><span class="p">[:</span><span class="n">ACTED_IN</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">movie</span><span class="p">:</span><span class="n">Movie</span><span class="p">)</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">DIRECTED</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">director</span><span class="p">:</span><span class="n">Person</span><span class="p">)</span>
<span class="n">RETURN</span> <span class="n">movie</span><span class="o">.</span><span class="n">title</span> <span class="n">AS</span> <span class="n">title</span><span class="p">,</span> <span class="n">director</span><span class="o">.</span><span class="n">name</span> <span class="n">AS</span> <span class="n">director</span>                                
</pre></div>
</div>
</div>
<p>Vous pouvez aussi réaliser des requêtes en posant des conditions sur la longueur du chemin reliant deux noeuds.
La longueur d’un chemin correspond au nombre d’arêtes qu’il faut emprunter pour aller d’une extrémité du chemin à l’autre :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[*]</span></code> : chemin de longueur quelconque</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[*&lt;number&gt;]</span></code> : chemin de longueur <code class="docutils literal notranslate"><span class="pre">&lt;number&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[*&lt;number1&gt;..&lt;number2&gt;]</span></code> : chemin dont la longueur est comprise entre <code class="docutils literal notranslate"><span class="pre">&lt;number1&gt;</span></code> et <code class="docutils literal notranslate"><span class="pre">&lt;number2&gt;</span></code> ; si <code class="docutils literal notranslate"><span class="pre">&lt;number1&gt;</span></code> n’est pas spécifié, la valeur par défaut est 0, si <code class="docutils literal notranslate"><span class="pre">&lt;number2&gt;</span></code> n’est pas spécifié la valeurs par défaut est l’infini</p></li>
</ul>
<div class="tip admonition">
<p class="admonition-title">Example</p>
<p>Quel est l’un des chemins les plus courts qui relie <code class="docutils literal notranslate"><span class="pre">Tom</span> <span class="pre">Hanks</span></code> et <code class="docutils literal notranslate"><span class="pre">Robin</span> <span class="pre">Williams</span></code> ? Pour répondre à cette question vous pouvez utiliser <code class="docutils literal notranslate"><span class="pre">SHORTEST</span></code>, en spécifiant <code class="docutils literal notranslate"><span class="pre">1</span></code> pour ne retourner que l’un des chemins :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MATCH</span> <span class="n">path</span> <span class="o">=</span> <span class="n">SHORTEST</span> <span class="mi">1</span> <span class="p">((:</span><span class="n">Person</span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="s2">&quot;Tom Hanks&quot;</span><span class="p">})</span><span class="o">-</span><span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="o">-</span><span class="p">(:</span><span class="n">Person</span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="s2">&quot;Robin Williams&quot;</span><span class="p">}))</span>
<span class="n">RETURN</span> <span class="n">path</span>
</pre></div>
</div>
</div>
</section>
<section id="requete-a-plusieurs-motifs">
<h2><span class="section-number">3.1.4. </span>Requête à plusieurs motifs<a class="headerlink" href="#requete-a-plusieurs-motifs" title="Link to this heading">#</a></h2>
<p>Il est possible de sélectionner des noeuds, des relations ou une partie du graphe en fonction d’un <strong>ensemble de motifs</strong>, plutôt que d’un motif unique.
Les premiers exemples de la section précédente peuvent d’ailleurs être réécrits comme une requête à plusieurs motifs (voir ci-dessous).
Ces motifs peuvent être définis les uns après les autres au sein d’une même clause <code class="docutils literal notranslate"><span class="pre">MATCH</span></code>–les virgules jouent alors le rôle de ET logique–ou dans plusieurs clauses <code class="docutils literal notranslate"><span class="pre">MATCH</span></code> successives.
Chacun des motifs doit faire appel à au moins l’une des variables définies au sein des motifs précédents.</p>
<div class="tip admonition">
<p class="admonition-title">Example</p>
<p>D’après vous, que fait cette requête ?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MATCH</span> <span class="p">(:</span><span class="n">Movie</span><span class="p">{</span><span class="n">title</span><span class="p">:</span><span class="s2">&quot;Ninja Assassin&quot;</span><span class="p">})</span><span class="o">&lt;-</span><span class="p">[:</span><span class="n">ACTED_IN</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="n">Person</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">ACTED_IN</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(:</span><span class="n">Movie</span><span class="p">{</span><span class="n">title</span><span class="p">:</span><span class="s2">&quot;Speed Racer&quot;</span><span class="p">})</span>
<span class="n">RETURN</span> <span class="n">DISTINCT</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">as</span> <span class="n">actor</span>
</pre></div>
</div>
<p>On peut également écrire cette requête ainsi :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MATCH</span> <span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="n">Person</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">ACTED_IN</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(:</span><span class="n">Movie</span><span class="p">{</span><span class="n">title</span><span class="p">:</span><span class="s2">&quot;Speed Racer&quot;</span><span class="p">}),</span> <span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">ACTED_IN</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(:</span><span class="n">Movie</span><span class="p">{</span><span class="n">title</span><span class="p">:</span><span class="s2">&quot;Ninja Assassin&quot;</span><span class="p">})</span>
<span class="n">RETURN</span> <span class="n">DISTINCT</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">as</span> <span class="n">actor</span>
</pre></div>
</div>
<p>Ou encore ainsi :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MATCH</span> <span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="n">Person</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">ACTED_IN</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(:</span><span class="n">Movie</span><span class="p">{</span><span class="n">title</span><span class="p">:</span><span class="s2">&quot;Speed Racer&quot;</span><span class="p">})</span>
<span class="n">MATCH</span> <span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">ACTED_IN</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(:</span><span class="n">Movie</span><span class="p">{</span><span class="n">title</span><span class="p">:</span><span class="s2">&quot;Ninja Assassin&quot;</span><span class="p">})</span>
<span class="n">RETURN</span> <span class="n">DISTINCT</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">as</span> <span class="n">actor</span>
</pre></div>
</div>
</div>
</section>
<section id="quelques-fonctions-utiles">
<h2><span class="section-number">3.1.5. </span>Quelques fonctions utiles<a class="headerlink" href="#quelques-fonctions-utiles" title="Link to this heading">#</a></h2>
<p>Neo4j met à disposition un certain nombre de fonctions. Voir la <a class="reference external" href="https://neo4j.com/docs/cypher-manual/current/functions/">documentation</a>.</p>
<p>Les fonctions suivantes fournissent des informations utiles concernant le graphe :</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-center"><p>Graphe</p></th>
<th class="head text-left"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">labels()</span></code></p></td>
<td class="text-left"><p>Récupérer sous forme de liste tous les labels des noeuds sélectionnés</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">keys()</span></code></p></td>
<td class="text-left"><p>Récupérer toutes les clés de propriété des noeuds ou relations sélectionnés</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">type()</span></code></p></td>
<td class="text-left"><p>Récupérer le type d’une ou plusieurs relations</p></td>
</tr>
</tbody>
</table>
</div>
<p>Les fonctions suivantes sont des fonctions d’agrégation :</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-center"><p>Agrégation</p></th>
<th class="head text-left"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">avg()</span></code></p></td>
<td class="text-left"><p>Calculer la moyenne d’un ensemble de valeurs</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">max()</span></code></p></td>
<td class="text-left"><p>Calculer la valeur maximale d’un ensemble de valeurs</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">min()</span></code></p></td>
<td class="text-left"><p>Calculer la valeur minimale d’un ensemble de valeurs</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">sum()</span></code></p></td>
<td class="text-left"><p>Calculer la somme d’un ensemble de valeurs</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">collect()</span></code></p></td>
<td class="text-left"><p>Récupérer sous forme de liste les valeurs retournées par une expression</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">count()</span></code></p></td>
<td class="text-left"><p>Compter le nombre d’éléments. <code class="docutils literal notranslate"><span class="pre">count(*)</span></code> pour le nombre total, <code class="docutils literal notranslate"><span class="pre">count(&lt;expression&gt;)</span></code> pour le nombre d’éléments hors valeurs manquantes, <code class="docutils literal notranslate"><span class="pre">count(DISTINCT</span> <span class="pre">&lt;expression&gt;)</span></code> pour le nombre d’éléments distincts</p></td>
</tr>
</tbody>
</table>
</div>
<p>Faire précéder les fonctions d’agrégation par d’autres expressions revient à <strong>grouper les éléments</strong> en fonction de ces expressions,
puis à <strong>appliquer les fonctions d’agrégation à chacun des groupes</strong>.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-center"><p>Autre</p></th>
<th class="head text-left"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">DISTINCT</span></code></p></td>
<td class="text-left"><p>Récupérer les valeurs distinctes</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">size()</span></code></p></td>
<td class="text-left"><p>taille d’une liste ou d’une chaîne de caractères</p></td>
</tr>
</tbody>
</table>
</div>
<div class="tip admonition">
<p class="admonition-title">Example</p>
<p><strong>Exemple n°1</strong> : Pour compter le nombre de noeuds dont l’un des labels est <code class="docutils literal notranslate"><span class="pre">Person</span></code>, tapez :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">MATCH</span><span class="w"> </span><span class="p">(:</span><span class="n">Person</span><span class="p">)</span>
<span class="k">RETURN</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Exemple n°2</strong> : Pour afficher les différents types de relation et le nombre de relations par type :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">MATCH</span><span class="w"> </span><span class="p">()</span><span class="o">-</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">-</span><span class="p">()</span>
<span class="k">RETURN</span><span class="w"> </span><span class="k">type</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">relationType</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">count</span>
</pre></div>
</div>
<p>Dans cet exemple, l’instruction <code class="docutils literal notranslate"><span class="pre">RETURN</span></code> est équivalente à un <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> en SQL :
on commence à grouper les relations par type puis on compte le nombre de relations dans chaque groupe.<br />
<strong>Exemple n°3</strong> : Pour lister les noms de tous les acteurs, réalisateurs et producteurs du film <code class="docutils literal notranslate"><span class="pre">That</span> <span class="pre">Thing</span> <span class="pre">You</span> <span class="pre">Do</span></code> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MATCH</span> <span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="n">Person</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">ACTED_IN</span><span class="o">|</span><span class="n">DIRECTED</span><span class="o">|</span><span class="n">PRODUCED</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(:</span><span class="n">Movie</span> <span class="p">{</span><span class="n">title</span><span class="p">:</span><span class="s1">&#39;That Thing You Do&#39;</span><span class="p">})</span>
<span class="n">RETURN</span> <span class="n">collect</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>Que remarquez-vous ? Pour remédier à ce problème, vous pouvez utiliser <code class="docutils literal notranslate"><span class="pre">DISTINCT</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MATCH</span> <span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="n">Person</span><span class="p">)</span><span class="o">-</span><span class="p">[:</span><span class="n">ACTED_IN</span><span class="o">|</span><span class="n">DIRECTED</span><span class="o">|</span><span class="n">PRODUCED</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(:</span><span class="n">Movie</span> <span class="p">{</span><span class="n">title</span><span class="p">:</span><span class="s1">&#39;That Thing You Do&#39;</span><span class="p">})</span>
<span class="n">RETURN</span> <span class="n">collect</span><span class="p">(</span><span class="n">DISTINCT</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Vous pouvez également utiliser les opérateurs classiques : <code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">-</span></code>, <code class="docutils literal notranslate"><span class="pre">*</span></code>, <code class="docutils literal notranslate"><span class="pre">/</span></code>, <code class="docutils literal notranslate"><span class="pre">%</span></code> et <code class="docutils literal notranslate"><span class="pre">^</span></code>.
Vous pouvez concaténer des listes ou des chaînes de caractères avec <code class="docutils literal notranslate"><span class="pre">||</span></code> ou <code class="docutils literal notranslate"><span class="pre">+</span></code>.</p>
</section>
<section id="exercice">
<h2><span class="section-number">3.1.6. </span>Exercice<a class="headerlink" href="#exercice" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Affichez tout le graphe</p></li>
<li><p>En quelle année est né (<code class="docutils literal notranslate"><span class="pre">born</span></code>) l’acteur <code class="docutils literal notranslate"><span class="pre">Bill</span> <span class="pre">Paxton</span></code> ?</p></li>
<li><p>Quelle est la phrase d’accroche (<code class="docutils literal notranslate"><span class="pre">tagline</span></code>) et la date de parution (<code class="docutils literal notranslate"><span class="pre">released</span></code>) du film <code class="docutils literal notranslate"><span class="pre">Sleepless</span> <span class="pre">in</span> <span class="pre">Seattle</span></code> ?</p></li>
<li><p>Dans quel(s) film(s) <code class="docutils literal notranslate"><span class="pre">Jack</span> <span class="pre">Nicholson</span></code> a-t-il joué ? Affichez le résultat sous forme de liste.</p></li>
<li><p>Combien de films <code class="docutils literal notranslate"><span class="pre">Ron</span> <span class="pre">Howard</span></code> a-t-il dirigé ?</p></li>
<li><p>Affichez le sous-graphe constitué des films qui ont reçu une note, des utilisateurs qui les ont notés et des relations qui lient ces noeuds entre eux.</p></li>
<li><p>Quels sont les propriétés des relations <code class="docutils literal notranslate"><span class="pre">REVIEWED</span></code> ? N’affichez que les valeurs uniques.</p></li>
</ol>
<div class="dropdown admonition">
<p class="admonition-title">Aide</p>
<p>Utilisez <code class="docutils literal notranslate"><span class="pre">keys()</span></code> et <code class="docutils literal notranslate"><span class="pre">DISTINCT</span></code>. <code class="docutils literal notranslate"><span class="pre">DISTINCT</span></code> peut s’utiliser en dehors d’une fonction, voir la documentation.</p>
</div>
<ol class="arabic simple" start="8">
<li><p>Quelle moyenne le film <code class="docutils literal notranslate"><span class="pre">The</span> <span class="pre">Replacements</span></code> a-t-il obtenu ?</p></li>
</ol>
<div class="dropdown admonition">
<p class="admonition-title">Aide</p>
<p>Utilisez la propriété <code class="docutils literal notranslate"><span class="pre">rating</span></code> des relations <code class="docutils literal notranslate"><span class="pre">REVIEWED</span></code> et la propriété <code class="docutils literal notranslate"><span class="pre">title</span></code> des noeuds <code class="docutils literal notranslate"><span class="pre">Movie</span></code>. Utilisez la fonction <code class="docutils literal notranslate"><span class="pre">avg()</span></code>.</p>
</div>
<ol class="arabic simple" start="9">
<li><p>Avec quel(s) acteur(s) l’actrice <code class="docutils literal notranslate"><span class="pre">Carrie-Anne</span> <span class="pre">Moss</span></code> a-t-elle déjà joué ?</p></li>
</ol>
<div class="dropdown admonition">
<p class="admonition-title">Aide</p>
<p>Voir 3.1.3.</p>
</div>
<ol class="arabic simple" start="10">
<li><p>Qui a déjà à la fois réalisé un film et joué dans un film au cours de sa carrière ?</p></li>
</ol>
<div class="dropdown admonition">
<p class="admonition-title">Aide</p>
<p>Voir 3.1.4.</p>
</div>
<ol class="arabic simple" start="11">
<li><p>Affichez le nombre d’acteurs par date de naissance.</p></li>
</ol>
<div class="dropdown admonition">
<p class="admonition-title">Aide</p>
<p>Voir 3.1.5. Équivalent d’un <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>.</p>
</div>
<ol class="arabic simple" start="12">
<li><p>Affichez le nombre de rôles joués par chaque acteur dans chaque film.</p></li>
</ol>
<div class="dropdown admonition">
<p class="admonition-title">Aide</p>
<p>Utilisez <code class="docutils literal notranslate"><span class="pre">size()</span></code>.</p>
</div>
<ol class="arabic simple" start="13">
<li><p>Quel est le nombre maximal de rôles qu’a déjà eu à jouer chaque acteur dans un film ?</p></li>
</ol>
<div class="dropdown admonition">
<p class="admonition-title">Aide</p>
<p>Vous pouvez combiner plusieurs fonctions. Par exemple ici : <code class="docutils literal notranslate"><span class="pre">max()</span></code> et <code class="docutils literal notranslate"><span class="pre">size()</span></code>.</p>
</div>
<div class="dropdown admonition">
<p class="admonition-title">Bonus</p>
<ol class="arabic simple" start="14">
<li><p>Quels acteurs ont déjà joué avec des co-acteurs de <code class="docutils literal notranslate"><span class="pre">Natalie</span> <span class="pre">Portman</span></code> ?</p></li>
</ol>
<p><strong>Note</strong> : Aucun des co-co-acteurs de Natalie Portman n’a joué avec elle dans un film.
Autrement dit : personne n’est à la fois co-acteur de Natalie Portman sur un film et co-co-acteur de Natalie Portman sur un autre film.</p>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="03_lecture.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">3. </span>C<strong>R</strong>UD : Lecture</p>
      </div>
    </a>
    <a class="right-next"
       href="03_lecture_complexe.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">3.2. </span>Requête complexe</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requete-sur-les-noeuds">3.1.1. Requête sur les noeuds</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requete-sur-les-relations">3.1.2. Requête sur les relations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requete-a-partir-de-motifs-complexes">3.1.3. Requête à partir de motifs complexes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requete-a-plusieurs-motifs">3.1.4. Requête à plusieurs motifs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quelques-fonctions-utiles">3.1.5. Quelques fonctions utiles</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercice">3.1.6. Exercice</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Elena Berhocoïrigoin
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>